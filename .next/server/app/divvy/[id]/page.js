(()=>{var e={};e.id=6935,e.ids=[6935],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},78893:e=>{"use strict";e.exports=require("buffer")},92048:e=>{"use strict";e.exports=require("fs")},76162:e=>{"use strict";e.exports=require("stream")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},34273:(e,r,a)=>{"use strict";a.r(r),a.d(r,{GlobalError:()=>d.a,__next_app__:()=>u,originalPathname:()=>x,pages:()=>c,routeModule:()=>m,tree:()=>o}),a(94594),a(36852),a(50857);var t=a(23191),s=a(88716),i=a(37922),d=a.n(i),l=a(95231),n={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(n[e]=()=>l[e]);a.d(r,n);let o=["",{children:["divvy",{children:["[id]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,94594)),"C:\\Users\\bruno\\Documents\\GitHub\\Divvy\\app\\divvy\\[id]\\page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(a.bind(a,36852)),"C:\\Users\\bruno\\Documents\\GitHub\\Divvy\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(a.bind(a,50857)),"C:\\Users\\bruno\\Documents\\GitHub\\Divvy\\app\\not-found.tsx"]}],c=["C:\\Users\\bruno\\Documents\\GitHub\\Divvy\\app\\divvy\\[id]\\page.tsx"],x="/divvy/[id]/page",u={require:a,loadChunk:()=>Promise.resolve()},m=new t.AppPageRouteModule({definition:{kind:s.x.APP_PAGE,page:"/divvy/[id]/page",pathname:"/divvy/[id]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},52923:(e,r,a)=>{Promise.resolve().then(a.bind(a,76548))},76548:(e,r,a)=>{"use strict";a.r(r),a.d(r,{default:()=>ev});var t={};a.r(t);var s=a(10326),i=a(17577),d=a(35047),l=a(35442),n=a(10732),o=a(3679),c=a(46785),x=a(38934),u=a(90434),m=a(84231),p=a(40381);let h=[{value:"trip",label:"✈️ Viagem"},{value:"roommate",label:"\uD83C\uDFE0 Rep\xfablica"},{value:"event",label:"\uD83C\uDF89 Evento"},{value:"other",label:"\uD83D\uDCB0 Geral"}];function g({onSuccess:e,initialData:r}){let{user:a}=(0,n.a)(),[t,d]=(0,i.useState)(""),[c,x]=(0,i.useState)(""),[u,g]=(0,i.useState)("trip"),[b,y]=(0,i.useState)(""),[f,v]=(0,i.useState)(""),[j,k]=(0,i.useState)(!1);async function N(s){if(s.preventDefault(),t.trim()){k(!0);try{if(!a)throw Error("Usu\xe1rio n\xe3o autenticado");let s={name:t,description:c,type:u,endedat:f?new Date(f).toISOString():null};if(r){let{error:e}=await l.O.from("divvies").update(s).eq("id",r.id);if(e)throw e;p.ZP.success("Grupo atualizado!")}else{let{data:e,error:r}=await l.O.from("divvies").insert({...s,creatorid:a.id,isarchived:!1}).select().single();if(r)throw r;if(e){let{error:r}=await l.O.from("divvymembers").insert({divvyid:e.id,userid:a.id,email:a.email,role:"admin"});r&&console.error("Erro ao adicionar criador como membro:",r)}p.ZP.success("Grupo criado com sucesso!")}e()}catch(e){console.error(e),p.ZP.error(e.message||"Erro ao salvar grupo")}finally{k(!1)}}}return(0,s.jsxs)("form",{onSubmit:N,className:"space-y-4",children:[s.jsx("h3",{className:"text-lg font-bold text-gray-900 dark:text-white",children:r?"Editar Grupo":"Informa\xe7\xf5es do Novo Grupo"}),s.jsx(m.I,{label:"Nome do Grupo",value:t,onChange:e=>d(e.target.value),placeholder:"Ex: Aluguel Mensal",required:!0}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Tipo"}),s.jsx("select",{value:u,onChange:e=>g(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white",children:h.map(e=>s.jsx("option",{value:e.value,children:e.label},e.value))})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[s.jsx(m.I,{type:"date",label:"Data In\xedcio (Cria\xe7\xe3o)",value:b,onChange:e=>y(e.target.value)}),s.jsx(m.I,{type:"date",label:"Data Fim",value:f,onChange:e=>v(e.target.value)})]}),s.jsx("div",{className:"flex justify-end gap-3 pt-2",children:s.jsx(o.z,{type:"submit",isLoading:j,fullWidth:!0,children:r?"Salvar Altera\xe7\xf5es":"Criar Grupo"})})]})}var b=a(76557);let y=(0,b.Z)("Archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]);var f=a(37358),v=a(44389);let j=(0,b.Z)("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);var k=a(98091);let N={trip:"✈️",roommate:"\uD83C\uDFE0",event:"\uD83C\uDF89",other:"\uD83D\uDCB0",general:"\uD83D\uDCB0"},w={trip:"Viagem",roommate:"Rep\xfablica",event:"Evento",other:"Geral",general:"Geral"};function C({divvy:e,onUpdate:r}){let a=(0,d.useRouter)(),{user:t}=(0,n.a)(),[x,m]=(0,i.useState)(!1),[h,b]=(0,i.useState)(!1);if(!e||!e.id)return null;let C=t?.id===e.creatorid,D=async()=>{if(window.confirm("Tem certeza que deseja excluir este grupo? Todas as despesas ser\xe3o apagadas permanentemente.")){b(!0);try{let{error:r}=await l.O.from("divvies").delete().eq("id",e.id);if(r)throw r;p.ZP.success("Grupo exclu\xeddo com sucesso."),a.push("/dashboard")}catch(e){console.error(e),p.ZP.error("Erro ao excluir grupo: "+e.message),b(!1)}}},z=async()=>{let a=!e.isarchived,s=a?"arquivar":"desarquivar";if(window.confirm(`Deseja realmente ${s} este grupo?`)){b(!0);try{if(a){let r=await fetch("/api/groups/archive",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({divvyId:e.id,userId:t?.id})});if(!r.ok){let e=await r.json();throw Error(e.error||"Erro ao arquivar grupo")}}else{let{error:r}=await l.O.from("divvies").update({isarchived:!1,endedat:null}).eq("id",e.id);if(r)throw r}p.ZP.success(`Grupo ${a?"arquivado":"ativado"} com sucesso!`),r&&r()}catch(e){p.ZP.error(`Erro ao ${s}: `+e.message)}finally{b(!1)}}},S=e=>{if(!e)return null;try{let[r,a,t]=String(e).split("T")[0].split("-");if(!r||!a||!t)return null;return`${t}/${a}/${r}`}catch(e){return null}},P="general"===e.type?"other":e.type;return(0,s.jsxs)(s.Fragment,{children:[s.jsx("div",{className:`border-b -mx-4 md:-mx-8 -mt-4 md:-mt-8 mb-8 transition-colors duration-200 
          ${e.isarchived?"bg-gray-100 dark:bg-gray-800 border-gray-300 dark:border-gray-600":"bg-white dark:bg-gray-800 border-gray-200 dark:border-dark-700"}`,children:(0,s.jsxs)("div",{className:"max-w-5xl mx-auto px-4 py-6 md:px-8",children:[(0,s.jsxs)("div",{className:"flex flex-col md:flex-row md:items-start justify-between gap-4 mb-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[s.jsx("span",{className:"text-4xl filter grayscale-[.5]",children:N[P]||"\uD83D\uDCB0"}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.name,e.isarchived&&(0,s.jsxs)("span",{className:"text-xs bg-gray-600 dark:bg-gray-700 text-white px-2 py-1 rounded-full font-bold flex items-center gap-1",children:[s.jsx(y,{size:10})," Arquivado"]})]}),(0,s.jsxs)("div",{className:"text-sm text-gray-500 dark:text-gray-400 flex flex-wrap items-center gap-2 mt-1",children:[s.jsx("span",{children:w[P]||w.other}),s.jsx("span",{children:"•"}),(0,s.jsxs)("span",{children:["Criado em ",new Date(e.createdat).toLocaleDateString("pt-BR")]}),e.endedat&&(0,s.jsxs)(s.Fragment,{children:[s.jsx("span",{className:"hidden sm:inline",children:"•"}),(0,s.jsxs)("span",{className:"flex items-center gap-1 text-gray-600 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded",children:[s.jsx(f.Z,{size:12}),S(e.createdat)||"..."," → ",S(e.endedat)||"..."]})]})]})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[s.jsx(u.default,{href:"/dashboard",children:s.jsx(o.z,{variant:"outline",size:"sm",children:"← Voltar"})}),C&&(0,s.jsxs)(s.Fragment,{children:[s.jsx(o.z,{variant:"outline",size:"sm",onClick:()=>m(!0),title:"Editar Grupo",disabled:e.isarchived,children:s.jsx(v.Z,{size:16})}),s.jsx(o.z,{variant:"outline",size:"sm",onClick:z,title:e.isarchived?"Desarquivar":"Arquivar",isLoading:h,className:e.isarchived?"text-brand-600 dark:text-brand-400 border-brand-200 dark:border-brand-800":"text-gray-600 dark:text-gray-400",children:e.isarchived?s.jsx(j,{size:16}):s.jsx(y,{size:16})}),s.jsx(o.z,{variant:"outline",size:"sm",className:"text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 border-red-200 dark:border-red-900/30",onClick:D,isLoading:h,title:"Excluir Grupo",children:s.jsx(k.Z,{size:16})})]})]})]}),e.description&&s.jsx("p",{className:"text-gray-600 dark:text-gray-300 mt-2 max-w-2xl",children:e.description})]})}),s.jsx(c.u,{isOpen:x,onClose:()=>m(!1),title:"Editar Grupo",children:s.jsx(g,{onSuccess:()=>{m(!1),r&&r()},initialData:e})})]})}function D({divvyId:e,members:r,onSuccess:a,onCancel:t,initialData:d}){let{user:l}=(0,n.a)(),[c,x]=(0,i.useState)(""),[u,h]=(0,i.useState)(""),[g,b]=(0,i.useState)("food"),[y,f]=(0,i.useState)(new Date().toISOString().split("T")[0]),[v,j]=(0,i.useState)(""),[k,N]=(0,i.useState)("equal"),[w,C]=(0,i.useState)(new Set),[D,z]=(0,i.useState)({}),[S,P]=(0,i.useState)({}),[Z,E]=(0,i.useState)(!1),q=u?parseInt(u,10)/100:0,A=e=>{let a=r.find(r=>r.userid===e);return a?a.userprofiles?.displayname||a.userprofiles?.fullname||a.email.split("@")[0]:"Membro"},T=e=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(e),M=async t=>{if(t.preventDefault(),isNaN(q)||q<=0||!c.trim()||!v){p.ZP.error("Preencha os campos obrigat\xf3rios.");return}E(!0);try{let t=[];if("equal"===k){if(0===w.size)throw Error("Selecione pelo menos um participante.");let e=q/w.size;t=Array.from(w).map(r=>({participantuserid:r,amountowed:e}))}else if("exact"===k){let e=0;if(t=r.map(r=>{let a=parseFloat(D[r.userid]||"0");return a>0?(e+=a,{participantuserid:r.userid,amountowed:a}):null}).filter(e=>null!==e),Math.abs(e-q)>.05)throw Error(`A soma (R$ ${e.toFixed(2)}) deve ser igual ao total (R$ ${q.toFixed(2)}).`)}else if("percentage"===k){let e=0;if(t=r.map(r=>{let a=parseFloat(S[r.userid]||"0");return a>0?(e+=a,{participantuserid:r.userid,amountowed:q*a/100}):null}).filter(e=>null!==e),Math.abs(e-100)>.5)throw Error("A soma das porcentagens deve ser 100%.")}let s=d?`/api/expenses/${d.id}`:"/api/expenses",i=await fetch(s,{method:d?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({divvyId:e,paidByUserId:v,amount:q,category:g,description:c,date:y,splits:t})}),l=await i.json();if(!i.ok)throw Error(l.error||"Erro ao processar despesa");p.ZP.success(d?"Despesa atualizada!":"Despesa salva!"),a()}catch(e){console.error(e),p.ZP.error(e.message||"Erro ao salvar despesa.")}finally{E(!1)}};return(0,s.jsxs)("form",{onSubmit:M,className:"space-y-6",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsx("div",{className:"md:col-span-2",children:s.jsx(m.I,{label:"Descri\xe7\xe3o *",value:c,onChange:e=>x(e.target.value),placeholder:"Ex: Jantar Pizza",required:!0})}),(0,s.jsxs)("div",{children:[s.jsx(m.I,{label:"Valor (somente n\xfameros) *",type:"text",inputMode:"numeric",value:u,onChange:e=>h(e.target.value.replace(/\D/g,"")),required:!0,placeholder:"Ex: 15000 = R$ 150,00"}),s.jsx("p",{className:"mt-1 text-xs text-gray-500",children:u?`Total: ${T(q)}`:"Digite apenas n\xfameros, sem v\xedrgula ou ponto."})]}),s.jsx(m.I,{label:"Data",type:"date",value:y,onChange:e=>f(e.target.value)}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-700 dark:text-gray-300",children:"Categoria"}),(0,s.jsxs)("select",{className:"w-full rounded-lg border border-gray-300 dark:border-dark-600 px-3 py-2 bg-white dark:bg-dark-800 text-gray-900 dark:text-white",value:g,onChange:e=>b(e.target.value),children:[s.jsx("option",{value:"food",children:"\uD83C\uDF7D️ Alimenta\xe7\xe3o"}),s.jsx("option",{value:"transport",children:"\uD83D\uDE97 Transporte"}),s.jsx("option",{value:"accommodation",children:"\uD83C\uDFE8 Hospedagem"}),s.jsx("option",{value:"activity",children:"\uD83C\uDFAC Atividade"}),s.jsx("option",{value:"utilities",children:"\uD83D\uDCA1 Contas"}),s.jsx("option",{value:"shopping",children:"\uD83D\uDECD️ Compras"}),s.jsx("option",{value:"other",children:"\uD83D\uDCB0 Outros"})]})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-700 dark:text-gray-300",children:"Quem pagou?"}),s.jsx("select",{className:"w-full rounded-lg border border-gray-300 dark:border-dark-600 px-3 py-2 bg-white dark:bg-dark-800 text-gray-900 dark:text-white",value:v,onChange:e=>j(e.target.value),children:r.map(e=>s.jsx("option",{value:e.userid,children:e.userid===l?.id?"Eu":A(e.userid)},e.userid))})]})]}),(0,s.jsxs)("div",{className:"border-t border-gray-100 dark:border-dark-700 pt-4",children:[s.jsx("label",{className:"block text-sm font-bold mb-3 text-gray-900 dark:text-white",children:"Como dividir?"}),s.jsx("div",{className:"flex gap-2 mb-4 bg-gray-100 dark:bg-dark-800 p-1 rounded-lg w-fit",children:["equal","exact","percentage"].map(e=>s.jsx("button",{type:"button",onClick:()=>N(e),className:`px-4 py-1.5 rounded-md text-sm font-medium transition-all ${k===e?"bg-white dark:bg-dark-700 shadow text-brand-600 dark:text-brand-400":"text-gray-500 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200"}`,children:"equal"===e?"Igual":"exact"===e?"Valor":"%"},e))}),s.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto p-2 bg-gray-50 dark:bg-dark-800/50 rounded-xl custom-scrollbar border border-gray-100 dark:border-dark-800",children:r.map(e=>(0,s.jsxs)("div",{className:"flex items-center justify-between p-2 hover:bg-white dark:hover:bg-dark-800 rounded-lg transition-colors",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:["equal"===k&&s.jsx("input",{type:"checkbox",checked:w.has(e.userid),onChange:()=>{let r=new Set(w);r.has(e.userid)?r.delete(e.userid):r.add(e.userid),C(r)},className:"w-5 h-5 rounded border-gray-300 text-brand-600 focus:ring-brand-500"}),(0,s.jsxs)("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:[A(e.userid)," ",e.userid===v&&s.jsx("span",{className:"text-[10px] bg-brand-100 text-brand-700 px-1.5 py-0.5 rounded ml-1",children:"Pagou"})]})]}),"equal"===k&&s.jsx("span",{className:"text-xs font-mono text-gray-500",children:w.has(e.userid)?T(w.size?q/w.size:0):"-"}),"exact"===k&&s.jsx(m.I,{type:"number",step:"0.01",value:D[e.userid]||"",onChange:r=>z({...D,[e.userid]:r.target.value}),className:"w-24 text-right text-sm py-1",placeholder:"0.00"}),"percentage"===k&&(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"text-xs text-gray-400 font-mono",children:T(q*parseFloat(S[e.userid]||"0")/100)}),(0,s.jsxs)("div",{className:"relative",children:[s.jsx("input",{type:"number",value:S[e.userid]||"",onChange:r=>P({...S,[e.userid]:r.target.value}),className:"w-16 p-1 border rounded text-right text-sm pr-6 focus:ring-brand-500 focus:border-brand-500",placeholder:"0"}),s.jsx("span",{className:"absolute right-2 top-1.5 text-xs text-gray-400",children:"%"})]})]})]},e.userid))})]}),(0,s.jsxs)("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-100 dark:border-dark-700",children:[s.jsx(o.z,{type:"button",variant:"outline",onClick:t,disabled:Z,children:"Cancelar"}),s.jsx(o.z,{type:"submit",isLoading:Z,children:d?"Atualizar Despesa":"Salvar Despesa"})]})]})}var z=a(9015);let S={food:"\uD83C\uDF7D️",transport:"\uD83D\uDE97",accommodation:"\uD83C\uDFE8",activity:"\uD83C\uDFAC",utilities:"\uD83D\uDCA1",shopping:"\uD83D\uDECD️",other:"\uD83D\uDCB0"};function P({color:e}){return s.jsx("span",{className:"inline-block w-2.5 h-2.5 rounded align-middle",style:{backgroundColor:e??"#64748B"},"aria-hidden":!0})}function Z({name:e,color:r}){return e?(0,s.jsxs)("span",{className:"inline-flex items-center gap-1 border rounded px-2 py-0.5 text-xs",children:[s.jsx(P,{color:r}),s.jsx("span",{className:"truncate",children:e})]}):null}let E=({expense:e,payerName:r,onClick:a,formatMoney:t})=>{let i=e.category,d="string"==typeof i?i:i?.name,l="string"==typeof i?null:i?.color??null;return(0,s.jsxs)("div",{onClick:()=>a(e),className:"bg-white dark:bg-dark-900 p-4 rounded-xl shadow-sm border border-gray-100 dark:border-dark-800 flex justify-between items-center cursor-pointer hover:bg-gray-50 dark:hover:bg-dark-800 transition-all group",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[s.jsx("div",{className:"h-10 w-10 rounded-full bg-brand-50 dark:bg-brand-900/30 flex items-center justify-center text-xl group-hover:scale-110 transition-transform",children:S[e.category]||"\uD83D\uDCB0"}),(0,s.jsxs)("div",{className:"min-w-0",children:[(0,s.jsxs)("p",{className:"font-bold flex items-center gap-2 text-gray-900 dark:text-white truncate pr-2",children:[s.jsx("span",{className:"truncate",children:e.description||e.category}),s.jsx("span",{className:"flex-shrink-0 flex gap-1",children:e.locked&&s.jsx("span",{title:"Bloqueado",children:s.jsx(z.Z,{size:14,className:"text-red-500"})})})]}),(0,s.jsxs)("div",{className:"text-xs text-gray-500 flex flex-wrap items-center gap-2",children:[s.jsx("span",{children:new Date(e.date).toLocaleDateString()}),s.jsx("span",{children:"•"}),(0,s.jsxs)("span",{children:["pagou: ",s.jsx("b",{children:r})]}),d&&(0,s.jsxs)(s.Fragment,{children:[s.jsx("span",{children:"•"}),s.jsx(Z,{name:d,color:l})]})]})]})]}),s.jsx("span",{className:"font-bold text-lg text-gray-900 dark:text-white whitespace-nowrap pl-2",children:t(e.amount)})]})};var q=a(96030),A=a(41135),T=a(31009);function M({className:e,...r}){return s.jsx("div",{className:function(...e){return(0,T.m6)((0,A.W)(e))}("animate-pulse rounded-md bg-gray-200 dark:bg-dark-800",e),...r})}let O=(0,b.Z)("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);var $=a(94019);function I({expenses:e,members:r,loading:a,onExpenseClick:t,formatMoney:d,getMemberName:l,searchQuery:n,setSearchQuery:o,filterCategory:c,setFilterCategory:x,filterPayer:u,setFilterPayer:m}){let p=(0,i.useMemo)(()=>e.filter(e=>{if("all"!==c&&e.category!==c||"all"!==u&&e.paidbyuserid!==u)return!1;if(n){let r=n.toLowerCase(),a=(e.description||"").toLowerCase().includes(r),t=e.amount.toString().includes(r),s=e.category.toLowerCase().includes(r);return a||t||s}return!0}),[e,c,u,n]),h=(0,i.useMemo)(()=>{let e={};return p.forEach(r=>{let a=r.date.split("T")[0];e[a]||(e[a]=[]),e[a].push(r)}),Object.entries(e).sort((e,r)=>r[0].localeCompare(e[0]))},[p]),g=e=>{let r=new Date(e+"T12:00:00"),a=new Date,t=new Date;return(t.setDate(t.getDate()-1),r.toDateString()===a.toDateString())?"Hoje":r.toDateString()===t.toDateString()?"Ontem":r.toLocaleDateString("pt-BR",{weekday:"long",day:"numeric",month:"long"})},b=p.reduce((e,r)=>e+r.amount,0);return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex flex-col lg:flex-row gap-3 p-4 bg-white dark:bg-dark-900 rounded-xl border border-gray-100 dark:border-dark-800 shadow-sm sticky top-0 z-10 transition-all",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 text-gray-500 text-sm font-medium mb-2 lg:mb-0",children:[s.jsx(O,{size:16})," ",s.jsx("span",{className:"hidden sm:inline",children:"Filtros:"})]}),s.jsx("div",{className:"relative flex-1",children:s.jsx("input",{type:"text",placeholder:"Buscar despesa...",value:n,onChange:e=>o(e.target.value),className:"w-full pl-4 pr-4 py-2 rounded-lg border border-gray-200 dark:border-dark-700 bg-gray-50 dark:bg-dark-800 text-sm text-gray-900 dark:text-white focus:ring-2 focus:ring-brand-500 outline-none transition-all"})}),(0,s.jsxs)("div",{className:"flex gap-2 w-full lg:w-auto overflow-x-auto pb-1 lg:pb-0 scrollbar-hide",children:[(0,s.jsxs)("select",{value:c,onChange:e=>x(e.target.value),className:"flex-1 lg:flex-none px-3 py-2 rounded-lg border border-gray-200 dark:border-dark-700 bg-gray-50 dark:bg-dark-800 text-sm text-gray-700 dark:text-gray-300 focus:ring-2 focus:ring-brand-500 outline-none cursor-pointer",children:[s.jsx("option",{value:"all",children:"Todas Categorias"}),s.jsx("option",{value:"food",children:"\uD83C\uDF7D️ Alimenta\xe7\xe3o"}),s.jsx("option",{value:"transport",children:"\uD83D\uDE97 Transporte"}),s.jsx("option",{value:"accommodation",children:"\uD83C\uDFE8 Hospedagem"}),s.jsx("option",{value:"activity",children:"\uD83C\uDFAC Atividades"}),s.jsx("option",{value:"utilities",children:"\uD83D\uDCA1 Contas"}),s.jsx("option",{value:"shopping",children:"\uD83D\uDECD️ Compras"}),s.jsx("option",{value:"other",children:"\uD83D\uDCB0 Outros"})]}),(0,s.jsxs)("select",{value:u,onChange:e=>m(e.target.value),className:"flex-1 lg:flex-none px-3 py-2 rounded-lg border border-gray-200 dark:border-dark-700 bg-gray-50 dark:bg-dark-800 text-sm text-gray-700 dark:text-gray-300 focus:ring-2 focus:ring-brand-500 outline-none cursor-pointer",children:[s.jsx("option",{value:"all",children:"Todos Pagadores"}),r.map(e=>s.jsx("option",{value:e.userid,children:l(e.userid)},e.userid))]})]}),("all"!==c||"all"!==u||n)&&(0,s.jsxs)("button",{onClick:()=>{x("all"),m("all"),o("")},className:"px-3 py-2 text-sm font-medium text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors flex items-center gap-1 justify-center lg:justify-start",children:[s.jsx($.Z,{size:14})," Limpar"]})]}),("all"!==c||"all"!==u||n)&&!a&&(0,s.jsxs)("div",{className:"flex justify-between items-center px-2 text-sm text-gray-500 dark:text-gray-400 animate-fade-in",children:[(0,s.jsxs)("span",{children:["Encontrados: ",s.jsx("strong",{children:p.length})]}),(0,s.jsxs)("span",{children:["Total: ",s.jsx("strong",{children:d(b)})]})]}),a&&s.jsx("div",{className:"space-y-4",children:[1,2,3,4].map(e=>(0,s.jsxs)("div",{className:"flex items-center justify-between p-4 bg-white dark:bg-dark-900 rounded-xl border border-gray-100 dark:border-dark-800",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[s.jsx(M,{className:"h-10 w-10 rounded-full"}),(0,s.jsxs)("div",{className:"space-y-2",children:[s.jsx(M,{className:"h-4 w-32"}),s.jsx(M,{className:"h-3 w-20"})]})]}),s.jsx(M,{className:"h-6 w-16"})]},e))}),!a&&0===p.length&&s.jsx(q.Z,{message:"Nenhuma despesa encontrada",description:0===e.length?"Adicione uma nova despesa para come\xe7ar.":"Tente ajustar os filtros para ver os resultados."}),!a&&h.map(([e,r])=>(0,s.jsxs)("div",{className:"animate-fade-in-up",children:[s.jsx("h4",{className:"text-xs font-bold text-gray-400 dark:text-gray-500 uppercase tracking-wider mb-3 ml-1 sticky top-20 z-0 bg-gray-50/90 dark:bg-dark-950/90 backdrop-blur-sm py-1 w-fit px-2 rounded-lg",children:g(e)}),s.jsx("div",{className:"space-y-3",children:r.map(e=>s.jsx(E,{expense:e,payerName:l(e.paidbyuserid),formatMoney:d,onClick:t},e.id))})]},e))]})}function F(){return s.jsx("div",{className:"w-24 h-24 mx-auto",children:(0,s.jsxs)("svg",{viewBox:"0 0 100 100",className:"w-full h-full",children:[s.jsx("circle",{cx:"50",cy:"50",r:"45",className:"stroke-green-500 stroke-[5] fill-none animate-draw-circle origin-center -rotate-90",strokeLinecap:"round"}),s.jsx("path",{d:"M30 50 L45 65 L70 35",className:"stroke-green-500 stroke-[5] fill-none animate-draw-check",strokeLinecap:"round",strokeLinejoin:"round",style:{strokeDasharray:100,strokeDashoffset:100}})]})})}var B=a(43810);let L=(0,b.Z)("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);function _({divvyId:e,divvyName:r,isOpen:a,onClose:t}){let{user:d}=(0,n.a)(),[l,x]=(0,i.useState)(""),[u,h]=(0,i.useState)(!1),[g,b]=(0,i.useState)(""),[y,f]=(0,i.useState)(""),[v,j]=(0,i.useState)(!1);async function k(r){r.preventDefault(),h(!0);try{if(!d)throw Error("Usu\xe1rio n\xe3o autenticado");let r=await fetch("/api/invite/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({divvyId:e,invitedByUserId:d.id,email:l})}),a=await r.json();if(!r.ok)throw Error(a.error||"Erro ao enviar convite");b(a.inviteLink),p.ZP.success("Convite enviado com sucesso!")}catch(e){console.error(e),p.ZP.error(e.message||"Erro ao enviar convite")}finally{h(!1)}}function N(){t()}return s.jsx(c.u,{isOpen:a,onClose:N,title:g?"":`Convidar membro para ${r}`,children:g?(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center",children:[s.jsx(F,{}),s.jsx("p",{className:"text-lg font-bold text-gray-900 dark:text-white mt-2",children:"Convite Gerado!"}),(0,s.jsxs)("p",{className:"text-sm text-gray-500 text-center mb-4",children:["Um email foi enviado para ",l,"."]}),y&&s.jsx("div",{className:"p-3 bg-white rounded-xl border border-gray-200 shadow-sm mb-4",children:s.jsx("img",{src:y,alt:"QR Code do Convite",className:"w-40 h-40"})}),s.jsx("p",{className:"text-xs text-gray-400",children:"Escaneie para entrar no grupo"})]}),s.jsx("div",{className:"bg-gray-50 dark:bg-dark-900 p-4 rounded-xl border border-gray-100 dark:border-dark-700",children:(0,s.jsxs)("div",{className:"flex gap-2",children:[s.jsx("input",{type:"text",value:g,readOnly:!0,className:"flex-1 px-3 py-2 border border-gray-200 dark:border-dark-600 rounded-lg bg-white dark:bg-dark-800 text-sm text-gray-600 dark:text-gray-300 focus:outline-none"}),s.jsx(o.z,{type:"button",variant:"secondary",size:"sm",onClick:function(){navigator.clipboard.writeText(g),j(!0),setTimeout(()=>j(!1),2e3),p.ZP.success("Link copiado!")},children:v?"Copiado":s.jsx(B.Z,{size:16})})]})}),s.jsx("div",{className:"grid grid-cols-1 gap-3",children:(0,s.jsxs)("button",{onClick:()=>{let e=`Venha participar do grupo "${r}" no Divvy! ${g}`;window.open(`https://wa.me/?text=${encodeURIComponent(e)}`,"_blank")},className:"flex items-center justify-center gap-2 p-3 rounded-lg bg-green-50 hover:bg-green-100 text-green-700 transition-colors border border-green-200 font-semibold",children:[s.jsx(L,{size:18})," Compartilhar no WhatsApp"]})}),s.jsx(o.z,{type:"button",variant:"primary",fullWidth:!0,onClick:N,children:"Concluir"})]}):(0,s.jsxs)("form",{onSubmit:k,className:"space-y-4",children:[s.jsx(m.I,{label:"Email do convidado",type:"email",value:l,onChange:e=>x(e.target.value),placeholder:"usuario@email.com",required:!0}),(0,s.jsxs)("div",{className:"flex gap-3 mt-4",children:[s.jsx(o.z,{type:"button",variant:"outline",onClick:N,children:"Cancelar"}),s.jsx(o.z,{type:"submit",variant:"primary",fullWidth:!0,isLoading:u,disabled:!l,children:"Enviar convite"})]})]})})}a(31270);var R=a(48998);let G=(0,b.Z)("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),U=(0,b.Z)("Wallet",[["path",{d:"M21 12V7H5a2 2 0 0 1 0-4h14v4",key:"195gfw"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h16v-5",key:"195n9w"}],["path",{d:"M18 12a2 2 0 0 0 0 4h4v-4Z",key:"vllfpd"}]]);var V=a(54659),H=a(24230);let J=(0,b.Z)("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]),W=(0,b.Z)("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]),Q=(0,b.Z)("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),K=(0,b.Z)("ArrowDownLeft",[["path",{d:"M17 7 7 17",key:"15tmo1"}],["path",{d:"M17 17H7V7",key:"1org7z"}]]),X=(0,b.Z)("ArrowUpRight",[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]]);var Y=a(92447),ee=a(15188);let er=(0,b.Z)("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);var ea=a(46260);function et({divvyId:e,members:r,expenses:a,allSplits:t,transactions:d,onUpdateTransaction:x,onMarkAsSent:u}){let{user:m}=(0,n.a)(),[h,g]=(0,i.useState)(!1),[b,y]=(0,i.useState)([]),[f,v]=(0,i.useState)(!1),[j,k]=(0,i.useState)(!1),[N,w]=(0,i.useState)(null),[C,D]=(0,i.useState)([]),[z,S]=(0,i.useState)(!1),P=e=>{let a=r.find(r=>r.userid===e);if(!a)return"Membro";let t=a.userprofiles;return t?.displayname||t?.fullname||a.email?.split("@")[0]||"Participante"},Z=e=>{let a=r.find(r=>r.userid===e);return a?.userprofiles?.phone||null},E=e=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(e),q=(e,r)=>r||P(e),A=d.filter(e=>"paymentsent"===e.status&&e.touserid===m?.id),T=d.filter(e=>"rejected"===e.status&&e.fromuserid===m?.id),M=d.filter(e=>"confirmed"===e.status||"rejected"===e.status||"paymentsent"===e.status&&e.touserid!==m?.id),O=async(r,a,t)=>{k(!0),S(!0),D([]);try{let s=t;if(!s){let t=await fetch("/api/payments/create-pending",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({divvyId:e,fromUserId:m?.id,toUserId:r,amount:a})}),i=await t.json();if(!t.ok)throw Error(i.error||"Erro ao iniciar pagamento");s=i.transaction?.id}if(!s)throw Error("Transa\xe7\xe3o pendente n\xe3o encontrada.");w({to:r,amount:a,transactionId:s});let{data:i}=await l.O.from("payment_methods").select("*").eq("user_id",r).eq("is_active",!0).order("is_primary",{ascending:!1});i&&D(i)}catch(e){console.error("Error fetching payment methods",e),p.ZP.error("N\xe3o foi poss\xedvel iniciar o pagamento."),k(!1)}finally{S(!1)}},$=e=>ea.kE.find(r=>r.code===e)?.name||"Banco";return(0,s.jsxs)("div",{className:"space-y-6",children:[A.length>0&&(0,s.jsxs)("div",{className:"space-y-3",children:[s.jsx("h4",{className:"text-sm font-bold text-gray-500 uppercase tracking-wider",children:"Aguardando sua confirma\xe7\xe3o"}),A.map(e=>(0,s.jsxs)("div",{className:"bg-white dark:bg-dark-900 p-4 rounded-xl border-l-4 border-yellow-500 shadow-sm flex flex-col md:flex-row justify-between items-center gap-4 animate-pulse-slow",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[s.jsx(R.Z,{className:"text-yellow-500"}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("p",{className:"text-gray-900 dark:text-white font-medium",children:[s.jsx("span",{className:"font-bold",children:P(e.fromuserid)})," marcou como pago"]}),s.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:E(e.amount)}),s.jsx("p",{className:"text-xs text-gray-500",children:new Date(e.updatedat).toLocaleDateString()})]})]}),(0,s.jsxs)("div",{className:"flex gap-2 w-full md:w-auto",children:[s.jsx(o.z,{size:"sm",variant:"outline",className:"flex-1 md:flex-none border-red-200 text-red-600 hover:bg-red-50 dark:border-red-900/50 dark:hover:bg-red-900/20",onClick:()=>x(e,"reject"),children:"Recusar"}),s.jsx(o.z,{size:"sm",className:"flex-1 md:flex-none bg-green-600 text-white hover:bg-green-700",onClick:()=>x(e,"confirm"),children:"Confirmar Recebimento"})]})]},e.id))]}),T.length>0&&(0,s.jsxs)("div",{className:"space-y-3",children:[s.jsx("h4",{className:"text-sm font-bold text-red-500 uppercase tracking-wider",children:"Pagamentos Recusados"}),T.map(e=>(0,s.jsxs)("div",{className:"bg-red-50 dark:bg-red-900/20 p-4 rounded-xl border border-red-200 dark:border-red-800 flex items-center gap-4",children:[s.jsx(G,{className:"text-red-500 w-8 h-8"}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("p",{className:"text-sm text-red-800 dark:text-red-200 font-bold",children:["Seu pagamento de ",E(e.amount)," para ",P(e.touserid)," foi recusado."]}),s.jsx("p",{className:"text-xs text-red-600 dark:text-red-300 mt-1",children:"Entre em contato com o membro e tente novamente se necess\xe1rio."})]})]},e.id))]}),(0,s.jsxs)("div",{className:"bg-white dark:bg-dark-900 p-6 rounded-2xl border border-gray-100 dark:border-dark-800 shadow-sm",children:[(0,s.jsxs)("h3",{className:"font-bold mb-6 flex items-center gap-2 text-gray-900 dark:text-white",children:[s.jsx(U,{size:20,className:"text-brand-500"})," Acertos Sugeridos (Quem deve quem)"]}),s.jsx("div",{className:"space-y-3",children:f?s.jsx("div",{className:"text-center py-10 text-sm text-gray-500 dark:text-gray-400",children:"Carregando saldos..."}):0===b.length?(0,s.jsxs)("div",{className:"text-center py-10 flex flex-col items-center",children:[s.jsx("div",{className:"w-16 h-16 bg-green-50 dark:bg-green-900/20 rounded-full flex items-center justify-center mb-3",children:s.jsx(V.Z,{className:"text-green-500 w-8 h-8"})}),s.jsx("p",{className:"text-gray-900 dark:text-white font-medium",children:"Tudo em dia!"}),s.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Ningu\xe9m deve nada neste grupo."})]}):b.map((e,r)=>{let a=e.from===m?.id?"Voc\xea":q(e.from,e.fromDisplayName),t=e.to===m?.id?"Voc\xea":q(e.to,e.toDisplayName);return(0,s.jsxs)("div",{className:"p-4 bg-gray-50 dark:bg-dark-800/50 rounded-xl flex flex-col sm:flex-row justify-between items-center gap-4 border border-gray-100 dark:border-dark-700 relative overflow-hidden",children:[(e.from===m?.id||e.to===m?.id)&&s.jsx("div",{className:`absolute left-0 top-0 bottom-0 w-1 ${e.from===m?.id?"bg-red-500":"bg-green-500"}`}),(0,s.jsxs)("div",{className:"flex items-center gap-3 text-gray-900 dark:text-white w-full sm:w-auto justify-center sm:justify-start",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-8 h-8 rounded-full bg-red-100 dark:bg-red-900/30 flex items-center justify-center text-xs font-bold text-red-600 dark:text-red-400",children:a.charAt(0)}),s.jsx("span",{className:`font-semibold ${e.from===m?.id?"text-red-600 dark:text-red-400":""}`,children:a})]}),(0,s.jsxs)("div",{className:"flex flex-col items-center px-2",children:[s.jsx("span",{className:"text-[10px] text-gray-400 uppercase font-bold",children:"Deve"}),s.jsx(H.Z,{size:14,className:"text-gray-400"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-8 h-8 rounded-full bg-green-100 dark:bg-green-900/30 flex items-center justify-center text-xs font-bold text-green-600 dark:text-green-400",children:t.charAt(0)}),s.jsx("span",{className:`font-semibold ${e.to===m?.id?"text-green-600 dark:text-green-400":""}`,children:t})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-4 w-full sm:w-auto justify-between sm:justify-end",children:[s.jsx("span",{className:"font-bold text-gray-900 dark:text-white text-lg",children:E(e.amount)}),e.from===m?.id&&(()=>{let r=d.find(r=>r.fromuserid===e.from&&r.touserid===e.to&&"pending"===r.status);return d.some(r=>r.fromuserid===e.from&&r.touserid===e.to&&"paymentsent"===r.status)?null:s.jsx(o.z,{size:"sm",className:"bg-green-600 text-white hover:bg-green-700 shadow-md shadow-green-500/20",onClick:()=>O(e.to,e.amount,r?.id),children:r?"Registrar envio":"Paguei"})})(),e.from===m?.id&&d.some(r=>r.fromuserid===e.from&&r.touserid===e.to&&"paymentsent"===r.status)&&(0,s.jsxs)("span",{className:"text-xs font-bold text-yellow-600 dark:text-yellow-400 bg-yellow-100 dark:bg-yellow-900/30 px-3 py-1.5 rounded-full flex items-center gap-1",children:[s.jsx(R.Z,{size:12})," Aguardando"]})]})]},r)})})]}),(0,s.jsxs)("div",{className:"border-t border-gray-200 dark:border-dark-700 pt-6",children:[(0,s.jsxs)("button",{onClick:()=>g(!h),className:"flex items-center justify-between w-full text-left text-gray-500 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 transition-colors p-2 rounded-lg hover:bg-gray-50 dark:hover:bg-dark-800",children:[(0,s.jsxs)("span",{className:"flex items-center gap-2 font-medium",children:[s.jsx(J,{size:18})," Hist\xf3rico de Pagamentos"]}),h?s.jsx(W,{size:18}):s.jsx(Q,{size:18})]}),h&&s.jsx("div",{className:"mt-4 space-y-2 animate-fade-in-down",children:0===M.length?s.jsx("p",{className:"text-sm text-gray-400 italic px-4",children:"Nenhum pagamento registrado."}):M.map(e=>{let r=e.touserid===m?.id,a=e.fromuserid===m?.id;return(0,s.jsxs)("div",{className:"flex justify-between items-center p-3 text-sm border-b border-gray-100 dark:border-dark-800 last:border-0 hover:bg-gray-50 dark:hover:bg-dark-800/50 rounded-lg transition-colors",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:`p-2 rounded-full ${"confirmed"===e.status?"bg-green-100 dark:bg-green-900/20 text-green-600":"rejected"===e.status?"bg-red-100 dark:bg-red-900/20 text-red-600":"bg-yellow-100 dark:bg-yellow-900/20 text-yellow-600"}`,children:r?s.jsx(K,{size:16}):a?s.jsx(X,{size:16}):s.jsx(J,{size:16})}),(0,s.jsxs)("div",{children:[s.jsx("p",{className:"text-gray-900 dark:text-white font-medium",children:a?`Voc\xea pagou para ${P(e.touserid)}`:r?`Voc\xea recebeu de ${P(e.fromuserid)}`:`${P(e.fromuserid)} pagou para ${P(e.touserid)}`}),(0,s.jsxs)("p",{className:"text-xs text-gray-500",children:[new Date(e.updatedat).toLocaleDateString()," ",new Date(e.updatedat).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]})]}),(0,s.jsxs)("div",{className:"text-right",children:[s.jsx("span",{className:`font-bold ${"confirmed"===e.status?"text-green-600":"rejected"===e.status?"text-red-600 line-through":"text-yellow-600"}`,children:E(e.amount)}),s.jsx("p",{className:"text-[10px] text-gray-400 uppercase font-bold mt-0.5",children:"paymentsent"===e.status?"Enviado":"confirmed"===e.status?"Confirmado":"Recusado"})]})]},e.id)})})]}),s.jsx(c.u,{isOpen:j,onClose:()=>k(!1),title:"Realizar Pagamento",children:N&&(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"text-center",children:[s.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:"Voc\xea deve pagar para"}),s.jsx("h3",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:P(N.to)}),s.jsx("p",{className:"text-3xl font-black text-brand-600 dark:text-brand-400",children:E(N.amount)})]}),(0,s.jsxs)("div",{className:"bg-gray-50 dark:bg-dark-800 p-4 rounded-xl border border-gray-200 dark:border-dark-700",children:[s.jsx("p",{className:"text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-3",children:"Dados de Pagamento"}),z?s.jsx("div",{className:"text-center py-4 text-gray-400 text-sm",children:"Carregando m\xe9todos..."}):C.length>0?s.jsx("div",{className:"space-y-3",children:C.map(e=>(0,s.jsxs)("div",{className:"bg-white dark:bg-dark-900 p-3 rounded-lg border border-gray-200 dark:border-dark-700",children:[(0,s.jsxs)("div",{className:"flex justify-between items-start mb-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:["pix"===e.type?s.jsx(Y.Z,{size:16,className:"text-brand-500"}):s.jsx(ee.Z,{size:16,className:"text-green-500"}),s.jsx("span",{className:"font-bold text-sm text-gray-800 dark:text-gray-200",children:"pix"===e.type?"Chave Pix":$(e.bank_id)})]}),s.jsx("button",{onClick:()=>{let r="pix"===e.type?e.pix_key:`${e.account_number} ${e.agency}`;r&&navigator.clipboard.writeText(r),p.ZP.success("Copiado!")},className:"text-brand-600 hover:text-brand-700 p-1",title:"Copiar",children:s.jsx(B.Z,{size:14})})]}),"pix"===e.type?s.jsx("p",{className:"font-mono text-sm text-gray-600 dark:text-gray-300 break-all",children:e.pix_key}):(0,s.jsxs)("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:[(0,s.jsxs)("p",{children:["Ag: ",e.agency," | CC: ",e.account_number,"-",e.account_digit]}),s.jsx("p",{className:"text-xs text-gray-400 mt-1",children:e.account_holder_name})]})]},e.id))}):Z(N.to)?(0,s.jsxs)("div",{className:"flex items-center justify-between bg-white dark:bg-dark-900 p-3 rounded-lg border border-gray-200 dark:border-dark-700",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[s.jsx(er,{size:16,className:"text-gray-400"}),s.jsx("span",{className:"font-mono text-lg text-gray-900 dark:text-white select-all",children:Z(N.to)})]}),s.jsx("button",{onClick:()=>{navigator.clipboard.writeText(Z(N.to)||""),p.ZP.success("Copiado!")},className:"p-2 text-gray-500 hover:text-brand-600 hover:bg-brand-50 dark:hover:bg-brand-900/20 rounded-lg transition-colors",title:"Copiar",children:s.jsx(B.Z,{size:18})})]}):s.jsx("div",{className:"text-center py-4 text-gray-500 dark:text-gray-400 text-sm italic",children:"Este membro n\xe3o possui dados de pagamento cadastrados."})]}),s.jsx("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 rounded-xl border border-blue-100 dark:border-blue-900/50 text-sm text-blue-700 dark:text-blue-300",children:(0,s.jsxs)("p",{children:[s.jsx("strong",{children:"Aten\xe7\xe3o:"})," O Divvy n\xe3o processa pagamentos reais. Fa\xe7a a transfer\xeancia pelo seu banco e depois confirme abaixo."]})}),(0,s.jsxs)("div",{className:"flex gap-3",children:[s.jsx(o.z,{variant:"outline",fullWidth:!0,onClick:()=>k(!1),children:"Cancelar"}),s.jsx(o.z,{variant:"primary",fullWidth:!0,onClick:()=>{N&&(u(N.transactionId),k(!1),w(null))},children:"J\xe1 paguei, confirmar"})]})]})})]})}var es=a(62896),ei=a(60962);let ed=(0,b.Z)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),el=(0,b.Z)("ExternalLink",[["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}],["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["line",{x1:"10",x2:"21",y1:"14",y2:"3",key:"18c3s4"}]]);function en({isOpen:e,onClose:r,src:a,alt:t="Image"}){return e?(0,ei.createPortal)((0,s.jsxs)("div",{className:"fixed inset-0 z-[110] flex items-center justify-center bg-black/90 backdrop-blur-sm animate-fade-in",onClick:r,children:[s.jsx("button",{onClick:r,className:"absolute top-4 right-4 p-2 bg-black/50 text-white rounded-full hover:bg-white/20 transition-colors z-50",children:s.jsx($.Z,{size:24})}),(0,s.jsxs)("div",{className:"relative max-w-full max-h-full p-4 flex flex-col items-center",onClick:e=>e.stopPropagation(),children:[s.jsx("img",{src:a,alt:t,className:"max-w-full max-h-[85vh] object-contain rounded-lg shadow-2xl animate-scale-in"}),(0,s.jsxs)("div",{className:"flex gap-4 mt-4",children:[(0,s.jsxs)("a",{href:a,download:!0,className:"flex items-center gap-2 px-4 py-2 bg-white/10 text-white rounded-full hover:bg-white/20 transition-colors text-sm font-medium backdrop-blur-md",onClick:e=>e.stopPropagation(),children:[s.jsx(ed,{size:16})," Baixar"]}),(0,s.jsxs)("a",{href:a,target:"_blank",rel:"noreferrer",className:"flex items-center gap-2 px-4 py-2 bg-white/10 text-white rounded-full hover:bg-white/20 transition-colors text-sm font-medium backdrop-blur-md",onClick:e=>e.stopPropagation(),children:[s.jsx(el,{size:16})," Abrir Original"]})]})]})]}),document.body):null}let eo=(0,b.Z)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),ec=(0,b.Z)("Receipt",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1-2-1Z",key:"wqdwcb"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17V7",key:"pyj7ub"}]]),ex=(0,b.Z)("PieChart",[["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}],["path",{d:"M22 12A10 10 0 0 0 12 2v10z",key:"1rfc4y"}]]);var eu=a(24061),em=a(74975),ep=a(83855);let eh=(0,b.Z)("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}]]);var eg=a(71810);let eb=(0,b.Z)("Maximize2",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);var ey=a(98965);let ef=()=>{let e=(0,d.useRouter)(),r=(0,d.useParams)().id,a=Array.isArray(r)?r[0]:r,{user:u,session:m}=(0,n.a)(),[h,g]=(0,i.useState)(null),[b,v]=(0,i.useState)([]),[j,N]=(0,i.useState)([]),[w,S]=(0,i.useState)([]),[P,Z]=(0,i.useState)([]),[E,A]=(0,i.useState)(!0),[T,M]=(0,i.useState)("expenses"),[O,$]=(0,i.useState)(!1),[F,B]=(0,i.useState)(!1),[L,R]=(0,i.useState)(!1),[G,V]=(0,i.useState)(null),[H,J]=(0,i.useState)(!1),[W,Q]=(0,i.useState)(!1),[K,X]=(0,i.useState)(""),[Y,ee]=(0,i.useState)(""),[er,ea]=(0,i.useState)("all"),[ei,el]=(0,i.useState)("all"),ey=(0,i.useCallback)(async(e=!1)=>{if(a&&u&&m?.access_token){e||A(!0);try{let e=await fetch(`/api/groups/${a}/details`,{headers:{Authorization:`Bearer ${m.access_token}`}});if(!e.ok)throw 403===e.status&&g(null),Error("Falha ao carregar dados");let r=await e.json();g(r.divvy),v(r.members||[]),N(r.expenses||[]),Z(r.transactions||[]),S(r.splits||[])}catch(r){console.error("Erro geral no fetch:",r),e||p.ZP.error("Erro ao sincronizar dados.")}finally{A(!1)}}},[a,u,m]);(0,i.useEffect)(()=>{ey();let e=l.O.channel(`divvy_room_${a}`).on("postgres_changes",{event:"*",schema:"public",table:"expenses",filter:`divvyid=eq.${a}`},()=>ey(!0)).on("postgres_changes",{event:"*",schema:"public",table:"transactions",filter:`divvyid=eq.${a}`},()=>ey(!0)).on("postgres_changes",{event:"*",schema:"public",table:"divvymembers",filter:`divvyid=eq.${a}`},()=>ey(!0)).on("postgres_changes",{event:"UPDATE",schema:"public",table:"divvies",filter:`id=eq.${a}`},()=>ey(!0)).subscribe();return()=>{l.O.removeChannel(e)}},[ey,a]);let ef=e=>{let r=b.find(r=>r.userid===e);if(!r)return"Membro";let a=r.userprofiles;return a?.displayname||a?.fullname||r.email?.split("@")[0]||"Participante"},ev=e=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(e),ej=u?.id===h?.creatorid,ek=async(e,r)=>{if(!confirm(`Deseja ${"confirm"===r?"confirmar":"rejeitar"} este pagamento?`))return;let a=p.ZP.loading("Processando...");try{let t=await fetch("confirm"===r?"/api/payments/confirm":"/api/payments/reject",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({transactionId:e.id,userId:u?.id})}),s=await t.json();if(!t.ok)throw Error(s.error||"Erro ao processar");p.ZP.success(`Pagamento ${"confirmed"==("confirm"===r?"confirmed":"rejected")?"confirmado":"rejeitado"}.`,{id:a}),ey(!0)}catch(e){p.ZP.error(e.message,{id:a})}},eN=async(e,r)=>{let t=p.ZP.loading("Registrando...");try{let s=await fetch("/api/payments/mark-sent",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({divvyId:a,fromUserId:u?.id,toUserId:e,amount:r})}),i=await s.json();if(!s.ok)throw Error(i.error||"Erro ao registrar");p.ZP.success("Pagamento registrado! Credor notificado.",{id:t}),ey(!0)}catch(e){p.ZP.error(e.message,{id:t})}},ew=async e=>{if(!ej||!confirm("Desbloquear despesa manualmente?"))return;let r=p.ZP.loading("Desbloqueando...");try{let a=await fetch(`/api/expenses/${e.id}/unlock`,{method:"POST",headers:{"Content-Type":"application/json"}});if(!a.ok){let e=await a.json();throw Error(e.error||"Erro ao desbloquear")}p.ZP.success("Despesa desbloqueada.",{id:r}),R(!1),ey(!0)}catch(e){p.ZP.error(e.message,{id:r})}},eC=async()=>{if(!G||!confirm("Tem certeza que deseja excluir esta despesa? Isso afetar\xe1 os saldos."))return;let e=p.ZP.loading("Excluindo...");try{let r=await fetch(`/api/expenses/${G.id}`,{method:"DELETE"});if(!r.ok){let e=await r.json();throw Error(e.error||"Erro ao excluir")}p.ZP.success("Despesa exclu\xedda.",{id:e}),R(!1),V(null),ey(!0)}catch(r){p.ZP.error(r.message,{id:e})}},eD=()=>{J(!0),$(!0)},ez=async()=>{if(h&&u)try{if(!(await fetch("/api/groups/archive",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({divvyId:h.id,userId:u.id})})).ok)throw Error("Erro ao arquivar");p.ZP.success("Grupo arquivado."),ey(!0)}catch(e){p.ZP.error(e.message)}},eS=async()=>{if(h&&u)try{if(!(await fetch("/api/groups/dismiss-archive-suggestion",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({divvyId:h.id,userId:u.id})})).ok)throw Error("Erro ao ocultar");p.ZP.success("Sugest\xe3o ocultada."),ey(!0)}catch(e){p.ZP.error(e.message)}},eP=async(e,r)=>{if(!ej)return;if(e===u?.id){p.ZP.error("Voc\xea n\xe3o pode remover a si mesmo.");return}if(!confirm(`Tem certeza que deseja remover ${r} do grupo?`))return;let t=p.ZP.loading("Removendo...");try{let{error:s}=await l.O.from("divvymembers").delete().eq("divvyid",a).eq("userid",e);if(s)throw s;p.ZP.success(`${r} removido.`,{id:t}),ey(!0)}catch(e){p.ZP.error(`Erro ao remover: ${e.message}`,{id:t})}},eZ=async()=>{if(!h||!u)return;if(ej){p.ZP.error("O criador n\xe3o pode sair do grupo.");return}if(!confirm("Tem certeza que deseja sair deste grupo?"))return;let r=p.ZP.loading("Saindo do grupo...");try{if(!(await fetch("/api/groups/leave",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({divvyId:h.id,userId:u.id})})).ok)throw Error("Erro ao sair");p.ZP.success("Voc\xea saiu do grupo.",{id:r}),e.push("/dashboard")}catch(e){p.ZP.error(e.message,{id:r})}};if(E)return s.jsx("div",{className:"flex justify-center p-20",children:s.jsx(es.Z,{})});if(!h)return(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center py-20 px-4",children:[s.jsx(q.Z,{message:"Grupo n\xe3o acess\xedvel",description:"Voc\xea pode n\xe3o ter permiss\xe3o para ver este grupo ou ele n\xe3o existe."}),(0,s.jsxs)(o.z,{onClick:()=>window.location.reload(),variant:"outline",className:"mt-4 flex items-center gap-2",children:[s.jsx(eo,{size:16})," Tentar Novamente"]}),s.jsx(o.z,{onClick:()=>e.push("/dashboard"),variant:"ghost",className:"mt-2 text-gray-500",children:"Voltar ao Dashboard"})]});let eE=[{id:"expenses",label:"Despesas",icon:ec},{id:"balances",label:"Saldos",icon:U},{id:"charts",label:"An\xe1lise",icon:ex},{id:"members",label:"Membros",icon:eu.Z}],eq=G?w.filter(e=>e.expenseid===G.id):[];return(0,s.jsxs)("div",{className:"space-y-6",children:[s.jsx(C,{divvy:h,onUpdate:()=>ey(!0)}),h.archivesuggested&&!h.isarchived&&(0,s.jsxs)("div",{className:"bg-blue-50 border border-blue-200 p-4 rounded-xl flex flex-col md:flex-row justify-between items-center animate-fade-in-down gap-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[s.jsx(y,{className:"text-blue-600"}),(0,s.jsxs)("div",{children:[s.jsx("p",{className:"font-bold text-blue-900",children:"Todas as contas foram acertadas!"}),s.jsx("p",{className:"text-sm text-blue-700",children:"Deseja arquivar este grupo?"})]})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[s.jsx(o.z,{size:"sm",variant:"outline",className:"border-blue-200 text-blue-700 hover:bg-blue-100",onClick:eS,children:"N\xe3o agora"}),ej&&s.jsx(o.z,{size:"sm",onClick:ez,children:"Arquivar Agora"})]})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center gap-3 px-1 flex-wrap",children:[s.jsx("div",{className:"flex items-center gap-2",children:(0,s.jsxs)(o.z,{variant:"ghost",size:"sm",onClick:()=>{if(!j.length)return p.ZP.error("N\xe3o h\xe1 despesas para exportar.");let e=new Blob(["\uFEFF"+["Data;Descri\xe7\xe3o;Categoria;Quem Pagou;Valor;Comprovante",...j.map(e=>{let r=new Date(e.date).toLocaleDateString("pt-BR"),a=ef(e.paidbyuserid),t=`"${(e.description||"").replace(/"/g,'""')}"`;return[r,t,`"${(e.category||"").replace(/"/g,'""')}"`,a,e.amount.toFixed(2).replace(".",","),e.receiptphotourl||""].join(";")})].join("\n")],{type:"text/csv;charset=utf-8;"}),r=URL.createObjectURL(e),a=document.createElement("a");a.href=r,a.setAttribute("download",`${h?.name.replace(/\s+/g,"_")}_extrato_${new Date().toISOString().split("T")[0]}.csv`),document.body.appendChild(a),a.click(),document.body.removeChild(a)},className:"text-gray-500 hover:text-brand-600",children:[s.jsx(ed,{size:18,className:"mr-2"})," Exportar CSV"]})}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)(o.z,{variant:"outline",onClick:()=>B(!0),children:[s.jsx(em.Z,{size:18,className:"mr-2"})," Convidar"]}),(0,s.jsxs)(o.z,{onClick:()=>{V(null),J(!1),$(!0)},disabled:h.isarchived,children:[s.jsx(ep.Z,{size:18,className:"mr-2"})," Nova Despesa"]})]})]}),s.jsx("div",{className:"border-b border-gray-200 dark:border-dark-700",children:s.jsx("nav",{className:"flex space-x-8 overflow-x-auto scrollbar-hide",children:eE.map(e=>(0,s.jsxs)("button",{onClick:()=>M(e.id),className:`pb-4 px-1 border-b-2 font-medium text-sm flex items-center gap-2 transition-colors whitespace-nowrap ${T===e.id?"border-brand-500 text-brand-600 dark:text-brand-400":"border-transparent text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"}`,children:[s.jsx(e.icon,{size:16})," ",e.label]},e.id))})}),(0,s.jsxs)("div",{className:"min-h-[400px]",children:["expenses"===T&&s.jsx(I,{expenses:j,members:b,loading:E,onExpenseClick:e=>{V(e),J(!1),R(!0)},formatMoney:ev,getMemberName:ef,searchQuery:Y,setSearchQuery:ee,filterCategory:er,setFilterCategory:ea,filterPayer:ei,setFilterPayer:el}),"balances"===T&&s.jsx(et,{divvyId:a,members:b,expenses:j,allSplits:w,transactions:P,onUpdateTransaction:ek,onMarkAsSent:eN}),"charts"===T&&s.jsx("div",{className:"bg-white dark:bg-dark-900 p-6 rounded-2xl border border-gray-100 dark:border-dark-800",children:s.jsx(x.A,{expenses:j,members:b})}),"members"===T&&s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:b.map(e=>{let r=ef(e.userid);return(0,s.jsxs)("div",{className:"bg-white dark:bg-dark-900 p-4 rounded-xl border border-gray-100 dark:border-dark-800 flex items-center justify-between group hover:border-brand-200 dark:hover:border-brand-800 transition-colors",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"h-10 w-10 rounded-full bg-gray-100 dark:bg-dark-800 flex items-center justify-center overflow-hidden",children:e.userprofiles?.avatarurl?s.jsx("img",{src:e.userprofiles.avatarurl,alt:r,className:"w-full h-full object-cover"}):s.jsx("span",{className:"font-bold text-gray-600 dark:text-gray-300",children:(e.userprofiles?.fullname||e.email||"?").charAt(0).toUpperCase()})}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("p",{className:"font-bold text-gray-900 dark:text-white flex items-center gap-1",children:[r,h?.creatorid===e.userid&&s.jsx("span",{title:"Criador do Grupo",className:"flex items-center",children:s.jsx(eh,{size:12,className:"text-brand-500 fill-brand-500"})})]}),s.jsx("p",{className:"text-xs text-gray-500",children:e.email})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"text-[10px] uppercase font-black px-2 py-1 bg-gray-100 dark:bg-dark-800 rounded text-gray-500",children:"admin"===e.role?"Admin":"Membro"}),ej&&e.userid!==u?.id&&s.jsx("button",{onClick:()=>eP(e.userid,r),className:"p-1.5 text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded transition-colors",title:"Remover membro",children:s.jsx(k.Z,{size:16})}),!ej&&e.userid===u?.id&&s.jsx("button",{onClick:eZ,className:"p-1.5 text-red-400 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded transition-colors",title:"Sair do Grupo",children:s.jsx(eg.Z,{size:16})})]})]},e.id)})})]}),s.jsx(c.u,{isOpen:L,onClose:()=>R(!1),title:"Detalhes da Despesa",children:G&&(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex justify-between items-start",children:[(0,s.jsxs)("div",{children:[s.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white leading-tight",children:G.description||G.category}),(0,s.jsxs)("div",{className:"flex items-center gap-2 mt-1 text-sm text-gray-500",children:[s.jsx(f.Z,{size:14}),s.jsx("span",{children:new Date(G.date).toLocaleDateString()}),s.jsx("span",{children:"•"}),(0,s.jsxs)("span",{children:["Pago por ",s.jsx("strong",{className:"text-gray-700 dark:text-gray-300",children:ef(G.paidbyuserid)})]})]})]}),s.jsx("span",{className:"text-2xl font-black text-brand-600 dark:text-brand-400",children:ev(G.amount)})]}),(0,s.jsxs)("div",{className:"pt-2",children:[(0,s.jsxs)("h4",{className:"text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-3",children:["Divis\xe3o (",eq.length,")"]}),s.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto custom-scrollbar bg-gray-50 dark:bg-dark-800 p-3 rounded-xl",children:0===eq.length?s.jsx("p",{className:"text-sm text-gray-400",children:"Nenhuma divis\xe3o registrada."}):eq.map(e=>{let r=b.find(r=>r.userid===e.participantuserid),a=ef(e.participantuserid),t=e.participantuserid===G.paidbyuserid;return(0,s.jsxs)("div",{className:"flex justify-between items-center text-sm",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-6 h-6 rounded-full bg-gray-200 dark:bg-dark-700 flex items-center justify-center text-[10px] font-bold text-gray-600 dark:text-gray-300 overflow-hidden",children:r?.userprofiles?.avatarurl?s.jsx("img",{src:r.userprofiles.avatarurl,alt:a,className:"w-full h-full object-cover"}):a.charAt(0).toUpperCase()}),(0,s.jsxs)("span",{className:`text-gray-700 dark:text-gray-200 ${t?"font-semibold text-brand-600 dark:text-brand-400":""}`,children:[a," ",t&&s.jsx("span",{className:"text-[10px] bg-brand-100 dark:bg-brand-900/30 text-brand-700 dark:text-brand-300 px-1 rounded ml-1",children:"Pagou"})]})]}),s.jsx("span",{className:"font-mono font-medium text-gray-900 dark:text-white",children:ev(e.amountowed)})]},e.id)})})]}),G.receiptphotourl&&(0,s.jsxs)("div",{className:"rounded-lg overflow-hidden border border-gray-200 dark:border-dark-700 relative group",children:[s.jsx("img",{src:G.receiptphotourl,alt:"Comprovante",className:"w-full object-cover max-h-64 cursor-zoom-in hover:brightness-95 transition-all",onClick:()=>{X(G.receiptphotourl),Q(!0)}}),s.jsx("button",{className:"absolute top-2 right-2 p-2 bg-black/50 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>{X(G.receiptphotourl),Q(!0)},children:s.jsx(eb,{size:16})}),s.jsx("div",{className:"p-2 bg-gray-50 dark:bg-dark-800 text-xs text-center text-gray-500",children:s.jsx("a",{href:G.receiptphotourl,target:"_blank",rel:"noreferrer",className:"underline hover:text-brand-600",children:"Ver original"})})]}),G.locked?(0,s.jsxs)("div",{className:"bg-red-50 dark:bg-red-900/20 p-3 rounded-lg border border-red-100 dark:border-red-800 flex items-start gap-3",children:[s.jsx(z.Z,{className:"text-red-500 mt-1",size:18}),(0,s.jsxs)("div",{children:[s.jsx("p",{className:"text-sm font-bold text-red-900 dark:text-red-300",children:"Despesa Bloqueada"}),s.jsx("p",{className:"text-xs text-red-700 dark:text-red-400",children:"Esta despesa foi travada automaticamente ap\xf3s um fechamento de caixa."})]})]}):null,s.jsx("div",{className:"flex gap-3 pt-2",children:G.locked&&u?.id===h?.creatorid?(0,s.jsxs)(o.z,{fullWidth:!0,variant:"outline",onClick:()=>ew(G),children:[s.jsx(t.LockOpen,{size:16,className:"mr-2"})," Desbloquear (Criador)"]}):(0,s.jsxs)(s.Fragment,{children:[s.jsx(o.z,{fullWidth:!0,variant:"outline",onClick:()=>{R(!1),eD()},disabled:h?.isarchived||G.locked,children:"Editar"}),s.jsx(o.z,{fullWidth:!0,variant:"outline",className:"text-red-600 border-red-200 hover:bg-red-50 dark:hover:bg-red-900/20 dark:border-red-900/30",onClick:eC,disabled:h?.isarchived||G.locked,children:"Excluir"})]})})]})}),s.jsx(en,{isOpen:W,onClose:()=>Q(!1),src:K,alt:"Comprovante"}),s.jsx(c.u,{isOpen:O,onClose:()=>$(!1),title:H?"Editar Despesa":"Nova Despesa",size:"lg",children:s.jsx(D,{divvyId:a,members:b,onSuccess:()=>{$(!1),V(null),ey(!0)},onCancel:()=>$(!1),initialData:H&&G?G:void 0})}),s.jsx(_,{divvyId:a,divvyName:h?.name||"",isOpen:F,onClose:()=>B(!1)})]})};function ev(){return s.jsx(ey.i,{children:s.jsx(ef,{})})}},38934:(e,r,a)=>{"use strict";a.d(r,{A:()=>b});var t=a(10326);a(17577);var s=a(30660),i=a(20751),d=a(78948),l=a(99630),n=a(44675),o=a(49844),c=a(18423),x=a(62637),u=a(9997),m=a(8564);let p={food:"Alimenta\xe7\xe3o",transport:"Transporte",accommodation:"Hospedagem",activity:"Atividades",utilities:"Contas",shopping:"Compras",other:"Outros"},h=e=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(e),g=["#059669","#0891b2","#7c3aed","#db2777","#ea580c","#facc15","#64748b"],b=({expenses:e,members:r=[]})=>{let a=e.reduce((e,r)=>e+r.amount,0),b=Object.entries(e.reduce((e,r)=>(e[r.category]=(e[r.category]||0)+r.amount,e),{})).map(([e,r])=>({name:p[e]||e.charAt(0).toUpperCase()+e.slice(1),value:parseFloat(r.toFixed(2)),percentage:a>0?r/a*100:0})).sort((e,r)=>r.value-e.value),y=Object.entries(e.reduce((e,r)=>(e[r.paidbyuserid]=(e[r.paidbyuserid]||0)+r.amount,e),{})).map(([e,a])=>{let t=r.find(r=>r.userid===e);return{name:t?.userprofiles?.displayname||t?.userprofiles?.fullname||"Desconhecido",amount:parseFloat(a.toFixed(2))}}).sort((e,r)=>r.amount-e.amount);return 0===e.length?t.jsx("div",{className:"flex flex-col items-center justify-center py-12 text-gray-400",children:t.jsx("p",{children:"Sem dados suficientes para gerar gr\xe1ficos."})}):(0,t.jsxs)("div",{className:"space-y-12",children:[(0,t.jsxs)("div",{className:"flex flex-col md:flex-row items-center gap-8",children:[(0,t.jsxs)("div",{className:"w-full md:w-1/2 h-[300px]",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4 text-center md:text-left",children:"Por Categoria"}),t.jsx(s.h,{width:"100%",height:"100%",children:(0,t.jsxs)(i.u,{children:[t.jsx(d.b,{data:b,cx:"50%",cy:"50%",labelLine:!1,outerRadius:100,fill:"#8884d8",dataKey:"value",children:b.map((e,r)=>t.jsx(l.b,{fill:g[r%g.length]},`cell-${r}`))}),t.jsx(n.u,{formatter:(e,r,a)=>[`${h(e)} (${a.payload.percentage.toFixed(1)}%)`,r],contentStyle:{backgroundColor:"var(--tw-color-white, #fff)",borderRadius:"8px",border:"1px solid #e5e7eb",color:"#374151"}})]})})]}),(0,t.jsxs)("div",{className:"w-full md:w-1/2",children:[(0,t.jsxs)("div",{className:"bg-gray-50 dark:bg-dark-900/50 rounded-xl p-4 mb-6 border border-gray-100 dark:border-dark-700",children:[t.jsx("p",{className:"text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-1",children:"Total Gasto"}),t.jsx("p",{className:"text-3xl font-black text-brand-600 dark:text-brand-400",children:h(a)})]}),t.jsx("div",{className:"space-y-3",children:b.map((e,r)=>(0,t.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"w-3 h-3 rounded-full",style:{backgroundColor:g[r%g.length]}}),t.jsx("span",{className:"text-gray-700 dark:text-gray-300 font-medium",children:e.name})]}),(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[t.jsx("span",{className:"font-bold text-gray-900 dark:text-white",children:h(e.value)}),(0,t.jsxs)("span",{className:"text-xs text-gray-400 w-10 text-right",children:[e.percentage.toFixed(0),"%"]})]})]},e.name))})]})]}),y.length>0&&(0,t.jsxs)("div",{className:"pt-8 border-t border-gray-100 dark:border-dark-700",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-6",children:"Quem pagou o qu\xea?"}),t.jsx("div",{className:"h-[300px] w-full",children:t.jsx(s.h,{width:"100%",height:"100%",children:(0,t.jsxs)(o.v,{data:y,layout:"vertical",margin:{top:5,right:30,left:20,bottom:5},children:[t.jsx(c.q,{strokeDasharray:"3 3",horizontal:!1,stroke:"#e5e7eb",opacity:.3}),t.jsx(x.K,{type:"number",hide:!0}),t.jsx(u.B,{dataKey:"name",type:"category",width:100,tick:{fill:"#6b7280",fontSize:12},axisLine:!1,tickLine:!1}),t.jsx(n.u,{cursor:{fill:"transparent"},formatter:e=>[h(e),"Pagou"],contentStyle:{backgroundColor:"#fff",borderRadius:"8px",border:"1px solid #e5e7eb",color:"#374151"}}),t.jsx(m.$,{dataKey:"amount",fill:"#7c3aed",radius:[0,4,4,0],barSize:30,background:{fill:"#f3f4f6",radius:[0,4,4,0]}})]})})})]})]})}},96030:(e,r,a)=>{"use strict";a.d(r,{Z:()=>s});var t=a(10326);function s({message:e="Nada por aqui ainda!",description:r="Toque no bot\xe3o 'Novo Grupo' para come\xe7ar a dividir gastos."}){return(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center py-20 px-4 text-center animate-fade-in-up",children:[(0,t.jsxs)("div",{className:"relative mb-8",children:[t.jsx("div",{className:"absolute -inset-10 bg-brand-500/5 blur-[80px] rounded-full"}),(0,t.jsxs)("svg",{className:"w-48 h-48 text-gray-200 dark:text-dark-800 relative z-10",viewBox:"0 0 200 200",fill:"none",children:[t.jsx("circle",{cx:"100",cy:"100",r:"80",className:"fill-gray-50 dark:fill-dark-900/50"}),t.jsx("rect",{x:"65",y:"75",width:"70",height:"50",rx:"12",className:"stroke-gray-300 dark:stroke-dark-700 stroke-2 fill-white dark:fill-dark-800"}),t.jsx("path",{d:"M65 95 H135",className:"stroke-gray-200 dark:stroke-dark-700 stroke-2"}),t.jsx("g",{className:"animate-pulse",children:t.jsx("circle",{cx:"150",cy:"70",r:"3",className:"fill-brand-400"})})]})]}),t.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-2",children:e}),t.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-base max-w-sm mx-auto leading-relaxed",children:r})]})}a(17577)},46260:(e,r,a)=>{"use strict";a.d(r,{kE:()=>t});let t=[{code:"001",name:"Banco do Brasil",short:"BB"},{code:"237",name:"Bradesco",short:"Bradesco"},{code:"341",name:"Ita\xfa Unibanco",short:"Ita\xfa"},{code:"104",name:"Caixa Econ\xf4mica",short:"Caixa"},{code:"033",name:"Santander",short:"Santander"},{code:"260",name:"Nubank",short:"Nubank"},{code:"077",name:"Inter",short:"Inter"},{code:"336",name:"C6 Bank",short:"C6"},{code:"290",name:"PagBank",short:"PagBank"},{code:"380",name:"PicPay",short:"PicPay"},{code:"212",name:"Banco Original",short:"Original"},{code:"655",name:"Banco Neon",short:"Neon"},{code:"403",name:"Cora",short:"Cora"}]},24230:(e,r,a)=>{"use strict";a.d(r,{Z:()=>t});let t=(0,a(76557).Z)("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]])},37358:(e,r,a)=>{"use strict";a.d(r,{Z:()=>t});let t=(0,a(76557).Z)("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]])},54659:(e,r,a)=>{"use strict";a.d(r,{Z:()=>t});let t=(0,a(76557).Z)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},48998:(e,r,a)=>{"use strict";a.d(r,{Z:()=>t});let t=(0,a(76557).Z)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},74975:(e,r,a)=>{"use strict";a.d(r,{Z:()=>t});let t=(0,a(76557).Z)("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]])},24061:(e,r,a)=>{"use strict";a.d(r,{Z:()=>t});let t=(0,a(76557).Z)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]])},94594:(e,r,a)=>{"use strict";a.r(r),a.d(r,{default:()=>t});let t=(0,a(68570).createProxy)(String.raw`C:\Users\bruno\Documents\GitHub\Divvy\app\divvy\[id]\page.tsx#default`)}};var r=require("../../../webpack-runtime.js");r.C(e);var a=e=>r(r.s=e),t=r.X(0,[9276,7343,4118,3561,690,4562],()=>a(34273));module.exports=t})();