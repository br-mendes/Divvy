"use strict";(()=>{var e={};e.id=7056,e.ids=[7056],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},28555:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>m,patchFetch:()=>f,requestAsyncStorage:()=>v,routeModule:()=>p,serverHooks:()=>l,staticGenerationAsyncStorage:()=>c});var i={};r.r(i),r.d(i,{POST:()=>u});var s=r(49303),o=r(88716),a=r(60670),n=r(87070),d=r(30474);async function u(e){let t=(0,d.f)();try{let{inviteToken:r,userId:i,userEmail:s}=await e.json();if(!r||!i||!s)return n.NextResponse.json({error:"Missing required fields"},{status:400});let{data:o,error:a}=await t.from("divvyinvites").select("*, divvies(name, creatorid)").eq("id",r).single();if(a||!o)return n.NextResponse.json({error:"Convite inv\xe1lido ou n\xe3o encontrado."},{status:404});if("pending"!==o.status)return n.NextResponse.json({error:"Este convite j\xe1 foi utilizado."},{status:400});if(new Date(o.expiresat)<new Date)return n.NextResponse.json({error:"Este convite expirou."},{status:400});let{data:d}=await t.from("divvymembers").select("id").eq("divvyid",o.divvyid).eq("userid",i).single();if(d)return n.NextResponse.json({error:"Voc\xea j\xe1 faz parte deste grupo."},{status:400});let{error:u}=await t.from("divvymembers").insert({divvyid:o.divvyid,userid:i,email:s,role:"member",joinedat:new Date().toISOString()});if(u)throw u;let{error:p}=await t.from("divvyinvites").update({status:"accepted",acceptedat:new Date().toISOString()}).eq("id",r);if(p)throw p;let{data:v}=await t.from("userprofiles").select("fullname, displayname").eq("id",i).single(),c=v?.displayname||v?.fullname||s,l=o.divvies?.name||"Grupo",m=o.divvies?.creatorid;return m&&m!==i&&await t.from("notifications").insert({user_id:m,divvy_id:o.divvyid,type:"invite",title:"Novo Membro",message:`${c} aceitou o convite e entrou no grupo ${l}.`,created_at:new Date().toISOString(),is_read:!1}),n.NextResponse.json({success:!0,divvyId:o.divvyid,divvyName:l},{status:200})}catch(e){return console.error("Accept Invite Error:",e),n.NextResponse.json({error:e.message},{status:500})}}let p=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/invite/accept/route",pathname:"/api/invite/accept",filename:"route",bundlePath:"app/api/invite/accept/route"},resolvedPagePath:"C:\\Users\\bruno\\Documents\\GitHub\\Divvy\\app\\api\\invite\\accept\\route.ts",nextConfigOutput:"export",userland:i}),{requestAsyncStorage:v,staticGenerationAsyncStorage:c,serverHooks:l}=p,m="/api/invite/accept/route";function f(){return(0,a.patchFetch)({serverHooks:l,staticGenerationAsyncStorage:c})}},30474:(e,t,r)=>{r.d(t,{f:()=>a});var i=r(37857);let s="https://jpgifiumxqzbroejhudc.supabase.co",o=process.env.SUPABASE_SERVICE_ROLE_KEY;if(!s)throw Error("Missing env NEXT_PUBLIC_SUPABASE_URL");if(!o)throw Error("Missing env SUPABASE_SERVICE_ROLE_KEY");let a=()=>(0,i.eI)(s,o,{auth:{autoRefreshToken:!1,persistSession:!1}})}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[9276,5972,7857],()=>r(28555));module.exports=i})();