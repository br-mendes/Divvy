"use strict";(()=>{var e={};e.id=1468,e.ids=[1468],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},38432:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>m,patchFetch:()=>f,requestAsyncStorage:()=>c,routeModule:()=>p,serverHooks:()=>v,staticGenerationAsyncStorage:()=>l});var a={};t.r(a),t.d(a,{GET:()=>u});var i=t(49303),o=t(88716),s=t(60670),n=t(87070),d=t(30474);async function u(e){let r=(0,d.f)(),{searchParams:t}=new URL(e.url),a=t.get("divvyId");if(!a)return n.NextResponse.json({error:"divvyId is required"},{status:400});try{let{data:e,error:t}=await r.from("divvymembers").select("userid").eq("divvyid",a);if(t)throw t;let{data:i,error:o}=await r.from("expenses").select("id, paidbyuserid, amount").eq("divvyid",a);if(o)throw o;let s=i?.map(e=>e.id)||[],d=[];if(s.length>0){let{data:e,error:t}=await r.from("expensesplits").select("participantuserid, amountowed").in("expenseid",s);if(t)throw t;d=e||[]}let{data:u,error:p}=await r.from("transactions").select("*").eq("divvyid",a).order("createdat",{ascending:!1});if(p)throw p;let c={};return e?.forEach(e=>{c[e.userid]=0}),i?.forEach(e=>{void 0!==c[e.paidbyuserid]&&(c[e.paidbyuserid]+=e.amount)}),d.forEach(e=>{void 0!==c[e.participantuserid]&&(c[e.participantuserid]-=e.amountowed)}),u?.forEach(e=>{"confirmed"===e.status&&(void 0!==c[e.fromuserid]&&(c[e.fromuserid]+=e.amount),void 0!==c[e.touserid]&&(c[e.touserid]-=e.amount))}),n.NextResponse.json({balances:c,transactions:u||[]},{status:200})}catch(e){return console.error("Balance API Error:",e),n.NextResponse.json({error:e.message},{status:500})}}let p=new i.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/balance/route",pathname:"/api/balance",filename:"route",bundlePath:"app/api/balance/route"},resolvedPagePath:"C:\\Users\\bruno\\Documents\\GitHub\\Divvy\\app\\api\\balance\\route.ts",nextConfigOutput:"export",userland:a}),{requestAsyncStorage:c,staticGenerationAsyncStorage:l,serverHooks:v}=p,m="/api/balance/route";function f(){return(0,s.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:l})}},30474:(e,r,t)=>{t.d(r,{f:()=>s});var a=t(37857);let i="https://jpgifiumxqzbroejhudc.supabase.co",o=process.env.SUPABASE_SERVICE_ROLE_KEY;if(!i)throw Error("Missing env NEXT_PUBLIC_SUPABASE_URL");if(!o)throw Error("Missing env SUPABASE_SERVICE_ROLE_KEY");let s=()=>(0,a.eI)(i,o,{auth:{autoRefreshToken:!1,persistSession:!1}})}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[9276,5972,7857],()=>t(38432));module.exports=a})();