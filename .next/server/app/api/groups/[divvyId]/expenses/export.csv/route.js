"use strict";(()=>{var e={};e.id=4094,e.ids=[4094],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{e.exports=require("buffer")},18239:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>g,patchFetch:()=>m,requestAsyncStorage:()=>x,routeModule:()=>c,serverHooks:()=>v,staticGenerationAsyncStorage:()=>l});var s={};r.r(s),r.d(s,{GET:()=>d});var n=r(49303),o=r(88716),i=r(60670),a=r(87070),p=r(19692);function u(e){let t=String(e??"");return/[",\n]/.test(t)?`"${t.replace(/"/g,'""')}"`:t}async function d(e,{params:t}){let r=(0,p.$)(),s=t.divvyId,{data:{session:n}}=await r.auth.getSession();if(!n?.user)return a.NextResponse.json({error:"Unauthorized"},{status:401});let{searchParams:o}=new URL(e.url),i=o.get("from"),d=o.get("to"),{data:c}=await r.from("divvymembers").select("userid, email").eq("divvyid",s),x=new Map;(c??[]).forEach(e=>{x.set(e.userid,e.email)});let l=r.from("expenses").select(`
      id, expense_date, title, description, amount_cents, currency,
      payeruserid, categoryid,
      category:expense_categories(name, slug)
    `).eq("divvyid",s);i&&(l=l.gte("expense_date",i)),d&&(l=l.lte("expense_date",d));let{data:v,error:g}=await l.order("expense_date",{ascending:!1});if(g)return a.NextResponse.json({error:g.message},{status:500});let m=[];for(let e of(m.push("id,date,title,description,amount,currency,payer_email,category"),v??[])){let t=((Number(e.amount_cents)||0)/100).toFixed(2),r=x.get(e.payeruserid)??e.payeruserid,s=e.category?.name??"";m.push([u(e.id),u(e.expense_date),u(e.title),u(e.description),u(t),u(e.currency),u(r),u(s)].join(","))}let y=m.join("\n");return new a.NextResponse(y,{status:200,headers:{"Content-Type":"text/csv; charset=utf-8","Content-Disposition":`attachment; filename="divvy-${s}-expenses.csv"`}})}let c=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/groups/[divvyId]/expenses/export.csv/route",pathname:"/api/groups/[divvyId]/expenses/export.csv",filename:"route",bundlePath:"app/api/groups/[divvyId]/expenses/export.csv/route"},resolvedPagePath:"C:\\Users\\bruno\\Documents\\GitHub\\Divvy\\app\\api\\groups\\[divvyId]\\expenses\\export.csv\\route.ts",nextConfigOutput:"export",userland:s}),{requestAsyncStorage:x,staticGenerationAsyncStorage:l,serverHooks:v}=c,g="/api/groups/[divvyId]/expenses/export.csv/route";function m(){return(0,i.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:l})}},19692:(e,t,r)=>{r.d(t,{$:()=>o});var s=r(71615),n=r(20344);function o(){return(0,n.createServerClient)("https://jpgifiumxqzbroejhudc.supabase.co","sb_publishable_RWrlgQRxQHCQ45cEIia_ug_OT9ouCwi",{cookies:{get:e=>s.cookies().get(e)?.value,set(e,t,r){(0,s.cookies)().set(e,t,r)},remove(e,t){(0,s.cookies)().set(e,"",{...t,maxAge:0})}}})}}};var t=require("../../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[9276,5972,7857,958],()=>r(18239));module.exports=s})();