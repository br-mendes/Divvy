"use strict";(()=>{var e={};e.id=5109,e.ids=[5109],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},61212:e=>{e.exports=require("async_hooks")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},76162:e=>{e.exports=require("stream")},21764:e=>{e.exports=require("util")},84492:e=>{e.exports=require("node:stream")},94833:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>f,patchFetch:()=>y,requestAsyncStorage:()=>m,routeModule:()=>v,serverHooks:()=>g,staticGenerationAsyncStorage:()=>x});var i={};r.r(i),r.d(i,{POST:()=>c});var o=r(49303),s=r(88716),a=r(60670),n=r(87070),u=r(19692),p=r(95347),d=r(6659),l=r(22576);async function c(e,{params:t}){let r=(0,u.$)(),i=t.divvyId,{data:{session:o}}=await r.auth.getSession();if(!o?.user)return n.NextResponse.json({error:"Unauthorized"},{status:401});let{role:s,isCreator:a}=await (0,p.q)(i);if(!((0,d.e)(o.user.email)||a||"admin"===s))return n.NextResponse.json({error:"Forbidden"},{status:403});let c=await e.json(),v=String(c?.email??"").trim().toLowerCase(),m=c?.role==="admin"?"admin":"member";if(!v||!v.includes("@"))return n.NextResponse.json({error:"email inv\xe1lido"},{status:400});let{data:x,error:g}=await r.from("divvies").select("id, name").eq("id",i).single();if(g||!x)return n.NextResponse.json({error:g?.message??"Grupo n\xe3o encontrado"},{status:404});let{data:f,error:y}=await r.from("divvyinvites").insert({divvyid:i,invitedemail:v,invitedby:o.user.id,role:m,status:"pending"}).select("id, token, invitedemail, role, status, expiresat, createdat").single();if(y||!f)return n.NextResponse.json({error:y?.message??"Erro ao criar convite"},{status:500});let h=`${(0,l.getAppUrl)()}/invite/${f.token}`;try{await l.mi.emails.send({from:(0,l.getFromEmail)(),to:v,subject:`Convite para o grupo "${x.name}" no Divvy`,html:`
        <div style="font-family:Arial,sans-serif;line-height:1.5">
          <h2>Voc\xea foi convidado(a) para um grupo no Divvy</h2>
          <p><b>Grupo:</b> ${x.name.replace(/[&<>"']/g,e=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"})[e])}</p>
          <p>Clique no bot\xe3o abaixo para aceitar o convite:</p>
          <p>
            <a href="${h}"
               style="display:inline-block;padding:10px 14px;border-radius:8px;background:#111;color:#fff;text-decoration:none">
              Aceitar convite
            </a>
          </p>
          <p>Ou copie e cole este link:</p>
          <p><a href="${h}">${h}</a></p>
          <p style="opacity:.7;font-size:12px">
            Este convite expira automaticamente.
          </p>
        </div>
      `})}catch(e){return n.NextResponse.json({invite:f,warning:"Convite criado, mas falhou o envio de e-mail."},{status:201})}return n.NextResponse.json({invite:f},{status:201})}let v=new o.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/groups/[divvyId]/invites/route",pathname:"/api/groups/[divvyId]/invites",filename:"route",bundlePath:"app/api/groups/[divvyId]/invites/route"},resolvedPagePath:"C:\\Users\\bruno\\Documents\\GitHub\\Divvy\\app\\api\\groups\\[divvyId]\\invites\\route.ts",nextConfigOutput:"export",userland:i}),{requestAsyncStorage:m,staticGenerationAsyncStorage:x,serverHooks:g}=v,f="/api/groups/[divvyId]/invites/route";function y(){return(0,a.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:x})}},6659:(e,t,r)=>{r.d(t,{E:()=>i,e:()=>o});let i=["falecomdivvy@gmail.com","brunoafonso.mendes@gmail.com"].map(e=>e.toLowerCase().trim());function o(e){return!!e&&i.includes(e.toLowerCase().trim())}},95347:(e,t,r)=>{r.d(t,{q:()=>o});var i=r(19692);async function o(e){let t=(0,i.$)(),{data:{session:r}}=await t.auth.getSession();if(!r?.user)return{session:null,role:null,isCreator:!1};let{data:o}=await t.from("divvies").select("id, creatorid").eq("id",e).single(),s=!!o&&o.creatorid===r.user.id,{data:a}=await t.from("divvymembers").select("role").eq("divvyid",e).eq("userid",r.user.id).single();return{session:r,role:a?.role??null,isCreator:s}}},22576:(e,t,r)=>{r.d(t,{Gd:()=>s,mi:()=>i,vN:()=>o});let i=new(r(46495)).R(process.env.RESEND_API_KEY),o=process.env.RESEND_FROM||"nao-responda@divvyapp.online";function s(e){return`${"https://www.divvyapp.online".replace(/\/$/,"")}${e.startsWith("/")?e:`/${e}`}`}},19692:(e,t,r)=>{r.d(t,{$:()=>s});var i=r(71615),o=r(20344);function s(){return(0,o.createServerClient)("https://jpgifiumxqzbroejhudc.supabase.co","sb_publishable_RWrlgQRxQHCQ45cEIia_ug_OT9ouCwi",{cookies:{get:e=>i.cookies().get(e)?.value,set(e,t,r){(0,i.cookies)().set(e,t,r)},remove(e,t){(0,i.cookies)().set(e,"",{...t,maxAge:0})}}})}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[9276,5972,7857,958,6495],()=>r(94833));module.exports=i})();