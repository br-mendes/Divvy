"use strict";(()=>{var e={};e.id=9559,e.ids=[9559],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},61212:e=>{e.exports=require("async_hooks")},78893:e=>{e.exports=require("buffer")},84770:e=>{e.exports=require("crypto")},76162:e=>{e.exports=require("stream")},21764:e=>{e.exports=require("util")},84492:e=>{e.exports=require("node:stream")},30680:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>f,patchFetch:()=>y,requestAsyncStorage:()=>v,routeModule:()=>c,serverHooks:()=>x,staticGenerationAsyncStorage:()=>g});var s={};t.r(s),t.d(s,{POST:()=>l});var o=t(49303),i=t(88716),a=t(60670),n=t(87070),u=t(19692),d=t(6659),m=t(22576);async function p(e){let{to:r,groupName:t,requesterEmail:s,targetEmail:o,groupId:i}=e,a=`Divvy: aprova\xe7\xe3o para remover membro em "${t}"`,n=(0,m.Gd)(`/groups/${i}?tab=requests`),u=`Ol\xe1!

${s} solicitou remover ${o} do grupo "${t}".

Abra para aprovar/rejeitar:
${n}
`;await m.mi.emails.send({from:m.vN,to:r,subject:a,text:u})}async function l(e,{params:r}){let t=(0,u.$)(),{divvyId:s,userId:o}=r,{data:{session:i}}=await t.auth.getSession();if(!i?.user)return n.NextResponse.json({error:"Unauthorized"},{status:401});let a=await e.json().catch(()=>({})),m=a?.reason?String(a.reason).trim():null,{data:l,error:c}=await t.from("divvies").select("id, name, creatorid").eq("id",s).single();if(c||!l)return n.NextResponse.json({error:"Group not found"},{status:404});let{data:v,error:g}=await t.from("divvymembers").select("userid, email, role").eq("divvyid",s);if(g)return n.NextResponse.json({error:g.message},{status:500});let x=v?.find(e=>e.userid===i.user.id);if(!x&&l.creatorid!==i.user.id)return n.NextResponse.json({error:"Forbidden"},{status:403});let f=l.creatorid===i.user.id,y=x?.role==="admin",q=(0,d.e)(i.user.email),b=v?.find(e=>e.userid===o),h=b?.email??o;if(f||y||q){let{error:e}=await t.from("divvymembers").delete().eq("divvyid",s).eq("userid",o);return e?n.NextResponse.json({error:e.message},{status:500}):n.NextResponse.json({ok:!0,mode:"removed"})}let{data:w,error:j}=await t.from("divvy_action_requests").insert({divvyid:s,type:"remove_member",status:"pending",requested_by:i.user.id,target_userid:o,reason:m}).select("*").single();if(j)return n.NextResponse.json({error:j.message},{status:500});let R=new Set;(v??[]).forEach(e=>{"admin"===e.role&&R.add(String(e.email||"").toLowerCase().trim())});let _=v?.find(e=>e.userid===l.creatorid);_?.email&&R.add(String(_.email).toLowerCase().trim()),d.E.forEach(e=>R.add(e));let I=Array.from(R).filter(Boolean);try{await p({to:I,groupName:l.name??"Grupo",requesterEmail:i.user.email??i.user.id,targetEmail:h,groupId:s})}catch{}return n.NextResponse.json({ok:!0,mode:"requested",request:w},{status:201})}let c=new o.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/groups/[divvyId]/members/[userId]/remove/route",pathname:"/api/groups/[divvyId]/members/[userId]/remove",filename:"route",bundlePath:"app/api/groups/[divvyId]/members/[userId]/remove/route"},resolvedPagePath:"C:\\Users\\bruno\\Documents\\GitHub\\Divvy\\app\\api\\groups\\[divvyId]\\members\\[userId]\\remove\\route.ts",nextConfigOutput:"export",userland:s}),{requestAsyncStorage:v,staticGenerationAsyncStorage:g,serverHooks:x}=c,f="/api/groups/[divvyId]/members/[userId]/remove/route";function y(){return(0,a.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:g})}},6659:(e,r,t)=>{t.d(r,{E:()=>s,e:()=>o});let s=["falecomdivvy@gmail.com","brunoafonso.mendes@gmail.com"].map(e=>e.toLowerCase().trim());function o(e){return!!e&&s.includes(e.toLowerCase().trim())}},22576:(e,r,t)=>{t.d(r,{Gd:()=>i,mi:()=>s,vN:()=>o});let s=new(t(46495)).R(process.env.RESEND_API_KEY),o=process.env.RESEND_FROM||"nao-responda@divvyapp.online";function i(e){return`${"https://www.divvyapp.online".replace(/\/$/,"")}${e.startsWith("/")?e:`/${e}`}`}},19692:(e,r,t)=>{t.d(r,{$:()=>i});var s=t(71615),o=t(20344);function i(){return(0,o.createServerClient)("https://jpgifiumxqzbroejhudc.supabase.co","sb_publishable_RWrlgQRxQHCQ45cEIia_ug_OT9ouCwi",{cookies:{get:e=>s.cookies().get(e)?.value,set(e,r,t){(0,s.cookies)().set(e,r,t)},remove(e,r){(0,s.cookies)().set(e,"",{...r,maxAge:0})}}})}}};var r=require("../../../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[9276,5972,7857,958,6495],()=>t(30680));module.exports=s})();