"use strict";(()=>{var e={};e.id=9113,e.ids=[9113],e.modules={20145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},51309:e=>{e.exports=import("@supabase/supabase-js")},56249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},64277:(e,t,r)=>{r.a(e,async(e,i)=>{try{r.r(t),r.d(t,{config:()=>c,default:()=>d,routeModule:()=>v});var a=r(71802),n=r(47153),o=r(56249),s=r(65811),u=e([s]);s=(u.then?(await u)():u)[0];let d=(0,o.l)(s,"default"),c=(0,o.l)(s,"config"),v=new a.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/invite/accept.active",pathname:"/api/invite/accept.active",bundlePath:"",filename:""},userland:s});i()}catch(e){i(e)}})},76215:(e,t,r)=>{r.a(e,async(e,i)=>{try{r.d(t,{m:()=>o});var a=r(51309),n=e([a]);a=(n.then?(await n)():n)[0];let s="https://jpgifiumxqzbroejhudc.supabase.co",u="sb_publishable_RWrlgQRxQHCQ45cEIia_ug_OT9ouCwi";if(!s)throw Error("Missing env NEXT_PUBLIC_SUPABASE_URL");if(!u)throw Error("Missing env NEXT_PUBLIC_SUPABASE_ANON_KEY");async function o(e){let t=e.headers.get("authorization")?.split(" ")[1];if(!t)throw Error("Unauthorized");let r=(0,a.createClient)(s,u),{data:{user:i},error:n}=await r.auth.getUser(t);if(n||!i)throw Error("Unauthorized");return i}i()}catch(e){i(e)}})},30497:(e,t,r)=>{r.a(e,async(e,i)=>{try{r.d(t,{f:()=>u});var a=r(51309),n=e([a]);a=(n.then?(await n)():n)[0];let o="https://jpgifiumxqzbroejhudc.supabase.co",s=process.env.SUPABASE_SERVICE_ROLE_KEY;if(!o)throw Error("Missing env NEXT_PUBLIC_SUPABASE_URL");if(!s)throw Error("Missing env SUPABASE_SERVICE_ROLE_KEY");let u=()=>(0,a.createClient)(o,s,{auth:{autoRefreshToken:!1,persistSession:!1}});i()}catch(e){i(e)}})},65811:(e,t,r)=>{r.a(e,async(e,i)=>{try{r.r(t),r.d(t,{default:()=>s});var a=r(30497),n=r(76215),o=e([a,n]);async function s(e,t){if("POST"!==e.method)return t.status(405).json({error:"Method not allowed"});let r=e.headers.authorization;if(!r?.startsWith("Bearer "))return t.status(401).json({error:"Unauthorized"});let i=(0,a.f)(),{inviteToken:o}=e.body;if(!o)return t.status(400).json({error:"Missing required fields"});try{let r=await (0,n.m)(e,t),a=r.email;if(!a)return t.status(400).json({error:"Missing user email."});let{data:s,error:u}=await i.from("divvyinvites").select("*, divvies(name, creatorid)").eq("id",o).single();if(u||!s)return t.status(404).json({error:"Convite inv\xe1lido ou n\xe3o encontrado."});if("pending"!==s.status)return t.status(400).json({error:"Este convite j\xe1 foi utilizado."});if(s.invitedemail?.toLowerCase()!==a.toLowerCase())return t.status(403).json({error:"Este convite n\xe3o pertence ao usu\xe1rio autenticado."});if(new Date(s.expiresat)<new Date)return t.status(400).json({error:"Este convite expirou."});let{data:d}=await i.from("divvymembers").select("id").eq("divvyid",s.divvyid).eq("userid",r.id).single();if(d)return t.status(400).json({error:"Voc\xea j\xe1 faz parte deste grupo."});let{error:c}=await i.from("divvymembers").insert({divvyid:s.divvyid,userid:r.id,email:a,role:"member",joinedat:new Date().toISOString()});if(c)throw c;let{error:v}=await i.from("divvyinvites").update({status:"accepted",acceptedat:new Date().toISOString()}).eq("id",o);if(v)throw v;let{data:l}=await i.from("userprofiles").select("fullname, displayname").eq("id",r.id).single(),f=l?.displayname||l?.fullname||a,p=s.divvies?.name||"Grupo",h=s.divvies?.creatorid;return h&&h!==r.id&&await i.from("notifications").insert({user_id:h,divvy_id:s.divvyid,type:"invite",title:"Novo Membro",message:`${f} aceitou o convite e entrou no grupo ${p}.`,created_at:new Date().toISOString(),is_read:!1}),t.status(200).json({success:!0,divvyId:s.divvyid,divvyName:p})}catch(e){if(e?.message==="Unauthorized")return t.status(401).json({error:"Unauthorized"});return console.error("Accept Invite Error:",e),t.status(500).json({error:e.message})}}[a,n]=o.then?(await o)():o,i()}catch(e){i(e)}})},47153:(e,t)=>{var r;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},71802:(e,t,r)=>{e.exports=r(20145)}};var t=require("../../../webpack-api-runtime.js");t.C(e);var r=t(t.s=64277);module.exports=r})();