"use strict";(()=>{var e={};e.id=9591,e.ids=[9591],e.modules={20145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},51309:e=>{e.exports=import("@supabase/supabase-js")},56249:(e,r)=>{Object.defineProperty(r,"l",{enumerable:!0,get:function(){return function e(r,t){return t in r?r[t]:"then"in r&&"function"==typeof r.then?r.then(r=>e(r,t)):"function"==typeof r&&"default"===t?r:void 0}}})},70244:(e,r,t)=>{t.a(e,async(e,a)=>{try{t.r(r),t.d(r,{config:()=>l,default:()=>u,routeModule:()=>p});var i=t(71802),d=t(47153),s=t(56249),o=t(4877),n=e([o]);o=(n.then?(await n)():n)[0];let u=(0,s.l)(o,"default"),l=(0,s.l)(o,"config"),p=new i.PagesAPIRouteModule({definition:{kind:d.x.PAGES_API,page:"/api/dashboard/data.active",pathname:"/api/dashboard/data.active",bundlePath:"",filename:""},userland:o});a()}catch(e){a(e)}})},76215:(e,r,t)=>{t.a(e,async(e,a)=>{try{t.d(r,{m:()=>s});var i=t(51309),d=e([i]);i=(d.then?(await d)():d)[0];let o="https://jpgifiumxqzbroejhudc.supabase.co",n="sb_publishable_RWrlgQRxQHCQ45cEIia_ug_OT9ouCwi";if(!o)throw Error("Missing env NEXT_PUBLIC_SUPABASE_URL");if(!n)throw Error("Missing env NEXT_PUBLIC_SUPABASE_ANON_KEY");async function s(e){let r=e.headers.get("authorization")?.split(" ")[1];if(!r)throw Error("Unauthorized");let t=(0,i.createClient)(o,n),{data:{user:a},error:d}=await t.auth.getUser(r);if(d||!a)throw Error("Unauthorized");return a}a()}catch(e){a(e)}})},30497:(e,r,t)=>{t.a(e,async(e,a)=>{try{t.d(r,{f:()=>n});var i=t(51309),d=e([i]);i=(d.then?(await d)():d)[0];let s="https://jpgifiumxqzbroejhudc.supabase.co",o=process.env.SUPABASE_SERVICE_ROLE_KEY;if(!s)throw Error("Missing env NEXT_PUBLIC_SUPABASE_URL");if(!o)throw Error("Missing env SUPABASE_SERVICE_ROLE_KEY");let n=()=>(0,i.createClient)(s,o,{auth:{autoRefreshToken:!1,persistSession:!1}});a()}catch(e){a(e)}})},4877:(e,r,t)=>{t.a(e,async(e,a)=>{try{t.r(r),t.d(r,{default:()=>o});var i=t(30497),d=t(76215),s=e([i,d]);async function o(e,r){if("GET"!==e.method)return r.status(405).json({error:"Method not allowed"});try{let t=await (0,d.m)(e,r),a=(0,i.f)(),{data:s,error:o}=await a.from("divvies").select("*").eq("creatorid",t.id);if(o)throw o;let{data:n,error:u}=await a.from("divvymembers").select("divvyid").eq("userid",t.id);if(u)throw u;let l=(n||[]).map(e=>e.divvyid),p=[];if(l.length>0){let{data:e,error:r}=await a.from("divvies").select("*").in("id",l);if(r)throw r;p=e||[]}let f=[...s||[],...p],c=new Map;f.forEach(e=>c.set(e.id,e));let h=Array.from(c.values()),m=h.map(e=>e.id),v={};if(m.length>0){let{data:e,error:r}=await a.from("divvymembers").select(`
                *,
                userprofiles (
                    id, fullname, displayname, avatarurl
                )
            `).in("divvyid",m);if(r)throw r;(e||[]).forEach(e=>{v[e.divvyid]||(v[e.divvyid]=[]);let r=Array.isArray(e.userprofiles)?e.userprofiles[0]:e.userprofiles;v[e.divvyid].push({...e,userprofiles:r})})}let w={},E=new Map;if(m.forEach(e=>{w[e]={},(v[e]||[]).forEach(r=>{w[e][r.userid]={paid:0,owed:0}})}),m.length>0){let{data:e,error:r}=await a.from("expenses").select("id, divvyid, paidbyuserid, amount").in("divvyid",m);if(r)throw r;(e||[]).forEach(e=>{E.set(e.id,e.divvyid);let r=w[e.divvyid]||{};r[e.paidbyuserid]||(r[e.paidbyuserid]={paid:0,owed:0}),r[e.paidbyuserid].paid+=Number(e.amount||0),w[e.divvyid]=r});let t=(e||[]).map(e=>e.id);if(t.length>0){let{data:e,error:r}=await a.from("expensesplits").select("expenseid, participantuserid, amountowed").in("expenseid",t);if(r)throw r;(e||[]).forEach(e=>{let r=E.get(e.expenseid);if(!r)return;let t=w[r]||{};t[e.participantuserid]||(t[e.participantuserid]={paid:0,owed:0}),t[e.participantuserid].owed+=Number(e.amountowed||0),w[r]=t})}}let y=h.map(e=>{let r=v[e.id]||[],t=r.map(r=>{let t=w[e.id]?.[r.userid]||{paid:0,owed:0};return{userid:r.userid,paid:t.paid,owed:t.owed,email:r.email,userprofiles:r.userprofiles}});return{...e,members:r,member_count:Math.max(r.length,1),member_totals:t}});return y.sort((e,r)=>new Date(r.createdat).getTime()-new Date(e.createdat).getTime()),r.status(200).json(y)}catch(e){return console.error("Dashboard Data API Error:",e),r.status(500).json({error:e.message||"Falha ao carregar dashboard"})}}[i,d]=s.then?(await s)():s,a()}catch(e){a(e)}})},47153:(e,r)=>{var t;Object.defineProperty(r,"x",{enumerable:!0,get:function(){return t}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(t||(t={}))},71802:(e,r,t)=>{e.exports=t(20145)}};var r=require("../../../webpack-api-runtime.js");r.C(e);var t=r(r.s=70244);module.exports=t})();